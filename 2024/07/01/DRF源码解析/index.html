<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>DRF源码解析 | Hexo</title>
  <meta name="description" content="DRF组件 1. Web应用模式 2. api接口 3. RESTful API规范 幂等性   4. Django的CBV 4.1 CBV的简单使用 4.2 CBV的源码解析 4.2.1 面向对象知识点回顾 (1)继承 (2)反射   4.2.2 CBV的源码解析     5. Django_Rest_Framework 6. 环境安装与配置 7. DRF的APIView视图 7.1">
<meta property="og:type" content="article">
<meta property="og:title" content="DRF源码解析">
<meta property="og:url" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="Snail Book">
<meta property="og:description" content="DRF组件 1. Web应用模式 2. api接口 3. RESTful API规范 幂等性   4. Django的CBV 4.1 CBV的简单使用 4.2 CBV的源码解析 4.2.1 面向对象知识点回顾 (1)继承 (2)反射   4.2.2 CBV的源码解析     5. Django_Rest_Framework 6. 环境安装与配置 7. DRF的APIView视图 7.1">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/indepent_frontend_backend.png">
<meta property="og:image" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/indepent_frontend_backend-16318493319127.png">
<meta property="og:image" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/restful.gif">
<meta property="og:image" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/drf_logo-16318493501509.png">
<meta property="og:image" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/SimpleRouter-16318481562175.png">
<meta property="og:image" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/DefaultRouter-16318481562186.png">
<meta property="og:image" content="https://champion-yang.github.io/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E9%A1%B5%E9%9D%A2.png">
<meta property="article:published_time" content="2024-07-01T01:35:59.000Z">
<meta property="article:modified_time" content="2024-07-04T08:41:04.918Z">
<meta property="article:author" content="Sanil">
<meta property="article:tag" content="Django">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/indepent_frontend_backend.png">
  <!-- Canonical links -->
  <link rel="canonical" href="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Snail Book" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 7.2.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/champion-yang" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">柯北</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">研发工程师&amp;系统架构师&amp;项目管理</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="搜索" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/champion-yang" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://weibo.com/u/5730240952?tabtype=home" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>努力成为架构师的男人</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AD%98%E5%82%A8/">存储</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/">数据科学</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/">数据处理</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84%E5%B8%88/">系统架构师</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AF%BB%E4%B9%A6/">读书</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E8%80%83/">软考</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%BD%AF%E8%80%83/%E4%B8%AD%E9%A1%B9/">中项</a><span class="category-list-count">2</span></li></ul></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Django/" rel="tag">Django</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elasticsearch/" rel="tag">Elasticsearch</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kafka/" rel="tag">Kafka</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pandas/" rel="tag">Pandas</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B9%A6%E7%B1%8D/" rel="tag">书籍</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E8%80%83/" rel="tag">软考</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">标签云</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/Django/" style="font-size: 13px;">Django</a> <a href="/tags/Docker/" style="font-size: 13px;">Docker</a> <a href="/tags/Elasticsearch/" style="font-size: 13.5px;">Elasticsearch</a> <a href="/tags/Kafka/" style="font-size: 14px;">Kafka</a> <a href="/tags/Pandas/" style="font-size: 13.5px;">Pandas</a> <a href="/tags/Python/" style="font-size: 13px;">Python</a> <a href="/tags/Redis/" style="font-size: 13.5px;">Redis</a> <a href="/tags/hexo/" style="font-size: 13px;">hexo</a> <a href="/tags/%E4%B9%A6%E7%B1%8D/" style="font-size: 13px;">书籍</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 13px;">架构</a> <a href="/tags/%E8%BD%AF%E8%80%83/" style="font-size: 13.5px;">软考</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2024/07/18/06_%E5%85%B6%E4%BB%96/2024-07-18-api%E6%B5%8B%E8%AF%95%E6%80%9D%E8%B7%AF%E5%8F%8A%E4%BD%93%E7%B3%BB%E6%9E%84%E5%BB%BA/" class="title">2024-07-18-api测试思路及体系构建</a>
              </p>
              <p class="item-date">
                <time datetime="2024-07-18T02:32:37.000Z" itemprop="datePublished">2024-07-18</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E8%BD%AF%E8%80%83/">软考</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E8%BD%AF%E8%80%83/%E4%B8%AD%E9%A1%B9/">中项</a>
              </p>
              <p class="item-title">
                <a href="/2024/07/17/05_%E8%BD%AF%E8%80%83/01_%E4%B8%AD%E9%A1%B9/02%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95/" class="title">02信息技术发展</a>
              </p>
              <p class="item-date">
                <time datetime="2024-07-17T03:21:35.000Z" itemprop="datePublished">2024-07-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E8%BD%AF%E8%80%83/">软考</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E8%BD%AF%E8%80%83/%E4%B8%AD%E9%A1%B9/">中项</a>
              </p>
              <p class="item-title">
                <a href="/2024/07/16/05_%E8%BD%AF%E8%80%83/01_%E4%B8%AD%E9%A1%B9/01%E4%BF%A1%E6%81%AF%E5%8C%96%E5%8F%91%E5%B1%95/" class="title">01信息化发展</a>
              </p>
              <p class="item-date">
                <time datetime="2024-07-16T08:48:44.000Z" itemprop="datePublished">2024-07-16</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AD%98%E5%82%A8/">存储</a>
              </p>
              <p class="item-title">
                <a href="/2024/07/11/03_es/2024-07-11-escrud/" class="title">Elasticsearch 操作API</a>
              </p>
              <p class="item-date">
                <time datetime="2024-07-11T07:55:29.000Z" itemprop="datePublished">2024-07-11</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><i class="icon icon-angle-right"></i><a class="category-link" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%AD%98%E5%82%A8/">存储</a>
              </p>
              <p class="item-title">
                <a href="/2024/07/10/03_es/2024-07-10-es%E6%A6%82%E5%BF%B5%E7%9B%B8%E5%85%B3/" class="title">Elasticsearch 相关概念</a>
              </p>
              <p class="item-date">
                <time datetime="2024-07-10T07:55:29.000Z" itemprop="datePublished">2024-07-10</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
  <aside class="sidebar sidebar-toc collapse   in  " id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">文章目录</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DRF%E7%BB%84%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">DRF组件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Web%E5%BA%94%E7%94%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">1. Web应用模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-api%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.</span> <span class="toc-text">2. api接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-RESTful-API%E8%A7%84%E8%8C%83"><span class="toc-number">4.</span> <span class="toc-text">3. RESTful API规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">4.0.1.</span> <span class="toc-text">幂等性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Django%E7%9A%84CBV"><span class="toc-number">5.</span> <span class="toc-text">4. Django的CBV</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-CBV%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 CBV的简单使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-CBV%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 CBV的源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9F%A5%E8%AF%86%E7%82%B9%E5%9B%9E%E9%A1%BE"><span class="toc-number">5.2.1.</span> <span class="toc-text">4.2.1 面向对象知识点回顾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%BB%A7%E6%89%BF"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">(1)继承</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%8F%8D%E5%B0%84"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">(2)反射</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-CBV%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">5.2.2.</span> <span class="toc-text">4.2.2 CBV的源码解析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Django-Rest-Framework"><span class="toc-number">6.</span> <span class="toc-text">5. Django_Rest_Framework</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">6. 环境安装与配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-DRF%E7%9A%84APIView%E8%A7%86%E5%9B%BE"><span class="toc-number">8.</span> <span class="toc-text">7. DRF的APIView视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-APIView%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">8.1.</span> <span class="toc-text">7.1 APIView的简单使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-APIView%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">8.2.</span> <span class="toc-text">7.2 APIView的源码解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1%E3%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">8.3.</span> <span class="toc-text">7.1、请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1%E3%80%81%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">8.3.1.</span> <span class="toc-text">7.1.1、常用属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-data"><span class="toc-number">8.3.1.1.</span> <span class="toc-text">1).data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-query-params"><span class="toc-number">8.3.1.2.</span> <span class="toc-text">2).query_params</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-request-request"><span class="toc-number">8.3.1.3.</span> <span class="toc-text">3)request._request</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2%E3%80%81%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">8.3.2.</span> <span class="toc-text">7.1.2、基本使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2%E3%80%81%E5%93%8D%E5%BA%94"><span class="toc-number">8.4.</span> <span class="toc-text">7.2、响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-%E6%9E%84%E9%80%A0%E6%96%B9%E5%BC%8F"><span class="toc-number">8.4.0.1.</span> <span class="toc-text">7.2.1 构造方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-response%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">8.4.0.2.</span> <span class="toc-text">7.2.2 response对象的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-3-%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">8.4.0.3.</span> <span class="toc-text">7.2.3 状态码</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-Serializer"><span class="toc-number">9.</span> <span class="toc-text">8. 序列化器-Serializer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%AE%9A%E4%B9%89%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number">9.1.</span> <span class="toc-text">8.1 定义序列化器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%88%9B%E5%BB%BASerializer%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.2.</span> <span class="toc-text">8.2 创建Serializer对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">9.3.</span> <span class="toc-text">8.3 序列化器的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-1-%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">9.3.1.</span> <span class="toc-text">8.3.1 序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">9.3.1.1.</span> <span class="toc-text">(1)基本序列化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-2-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">9.3.2.</span> <span class="toc-text">8.3.2  反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81"><span class="toc-number">9.3.2.1.</span> <span class="toc-text">(1)数据验证</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-validate-%E5%AD%97%E6%AE%B5%E5%90%8D"><span class="toc-number">9.3.2.1.1.</span> <span class="toc-text">(1) validate_字段名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-validate"><span class="toc-number">9.3.2.1.2.</span> <span class="toc-text">(2) validate</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">9.3.2.2.</span> <span class="toc-text">(2)反序列化-保存数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%99%84%E5%8A%A0%E8%AF%B4%E6%98%8E"><span class="toc-number">9.3.2.3.</span> <span class="toc-text">(3) 附加说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-3%E3%80%81%E5%9F%BA%E4%BA%8EAPIView%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.3.3.</span> <span class="toc-text">8.3.3、基于APIView的接口实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E6%A8%A1%E5%9E%8B%E7%B1%BB%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number">9.4.</span> <span class="toc-text">8.4 模型类序列化器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AE%9A%E4%B9%89"><span class="toc-number">9.4.0.1.</span> <span class="toc-text">(1)定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5"><span class="toc-number">9.4.0.2.</span> <span class="toc-text">(2)指定字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B7%BB%E5%8A%A0%E9%A2%9D%E5%A4%96%E5%8F%82%E6%95%B0"><span class="toc-number">9.4.0.3.</span> <span class="toc-text">(3)添加额外参数</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E8%A7%86%E5%9B%BE"><span class="toc-number">10.</span> <span class="toc-text">9. 视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1%E3%80%81GenericAPIView-%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">10.1.</span> <span class="toc-text">9.1、GenericAPIView[通用视图类]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-get-serializer-class-self"><span class="toc-number">10.1.0.1.</span> <span class="toc-text">(1)get_serializer_class(self)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-get-serializer-self-args-kwargs"><span class="toc-number">10.1.0.2.</span> <span class="toc-text">(2)get_serializer(self, *args, **kwargs)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-get-queryset-self"><span class="toc-number">10.1.0.3.</span> <span class="toc-text">(3)get_queryset(self)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-get-object-self"><span class="toc-number">10.1.0.4.</span> <span class="toc-text">(4)get_object(self)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2%E3%80%815%E4%B8%AA%E8%A7%86%E5%9B%BE%E6%89%A9%E5%B1%95%E7%B1%BB"><span class="toc-number">10.2.</span> <span class="toc-text">9.2、5个视图扩展类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-ListModelMixin"><span class="toc-number">10.2.0.1.</span> <span class="toc-text">(1)ListModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89CreateModelMixin"><span class="toc-number">10.2.0.2.</span> <span class="toc-text">（2）CreateModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89RetrieveModelMixin"><span class="toc-number">10.2.0.3.</span> <span class="toc-text">（3）RetrieveModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89UpdateModelMixin"><span class="toc-number">10.2.0.4.</span> <span class="toc-text">（4）UpdateModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%885%EF%BC%89DestroyModelMixin"><span class="toc-number">10.2.0.5.</span> <span class="toc-text">（5）DestroyModelMixin</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3%E3%80%81-GenericAPIView%E7%9A%84%E8%A7%86%E5%9B%BE%E5%AD%90%E7%B1%BB"><span class="toc-number">10.3.</span> <span class="toc-text">9.3、 GenericAPIView的视图子类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89CreateAPIView"><span class="toc-number">10.3.0.1.</span> <span class="toc-text">（1）CreateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89ListAPIView"><span class="toc-number">10.3.0.2.</span> <span class="toc-text">（2）ListAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89RetrieveAPIView"><span class="toc-number">10.3.0.3.</span> <span class="toc-text">（3）RetrieveAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%884%EF%BC%89DestoryAPIView"><span class="toc-number">10.3.0.4.</span> <span class="toc-text">（4）DestoryAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%885%EF%BC%89UpdateAPIView"><span class="toc-number">10.3.0.5.</span> <span class="toc-text">（5）UpdateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%886%EF%BC%89ListCreateAPIView"><span class="toc-number">10.3.0.6.</span> <span class="toc-text">（6）ListCreateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%887%EF%BC%89RetrieveUpdateAPIView"><span class="toc-number">10.3.0.7.</span> <span class="toc-text">（7）RetrieveUpdateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%888%EF%BC%89RetrieveDestoryAPIView"><span class="toc-number">10.3.0.8.</span> <span class="toc-text">（8）RetrieveDestoryAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%889%EF%BC%89RetrieveUpdateDestoryAPIView"><span class="toc-number">10.3.0.9.</span> <span class="toc-text">（9）RetrieveUpdateDestoryAPIView</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4%E3%80%81%E8%A7%86%E5%9B%BE%E9%9B%86"><span class="toc-number">10.4.</span> <span class="toc-text">9.4、视图集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-1%E3%80%81ViewSet"><span class="toc-number">10.4.1.</span> <span class="toc-text">9.4.1、ViewSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-2%E3%80%81GenericViewSet"><span class="toc-number">10.4.2.</span> <span class="toc-text">9.4.2、GenericViewSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-3%E3%80%81ModelViewSet%E5%92%8CReadOnlyModelViewSet"><span class="toc-number">10.4.3.</span> <span class="toc-text">9.4.3、ModelViewSet和ReadOnlyModelViewSet</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E8%B7%AF%E7%94%B1Routers"><span class="toc-number">11.</span> <span class="toc-text">10. 路由Routers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">11.1.</span> <span class="toc-text">10.1 使用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E8%A7%86%E5%9B%BE%E9%9B%86%E4%B8%AD%E9%99%84%E5%8A%A0action%E7%9A%84%E5%A3%B0%E6%98%8E"><span class="toc-number">11.2.</span> <span class="toc-text">10.2 视图集中附加action的声明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E8%B7%AF%E7%94%B1router%E5%BD%A2%E6%88%90URL%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">11.3.</span> <span class="toc-text">10.3 路由router形成URL的方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11%E3%80%81%E5%85%B6%E5%AE%83%E5%8A%9F%E8%83%BD%E7%BB%84%E4%BB%B6"><span class="toc-number">12.</span> <span class="toc-text">11、其它功能组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-%E8%AE%A4%E8%AF%81Authentication"><span class="toc-number">12.1.</span> <span class="toc-text">11.1. 认证Authentication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E6%9D%83%E9%99%90Permissions"><span class="toc-number">12.2.</span> <span class="toc-text">11.2. 权限Permissions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">12.2.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">12.2.2.</span> <span class="toc-text">提供的权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BE%E4%BE%8B"><span class="toc-number">12.2.3.</span> <span class="toc-text">举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90"><span class="toc-number">12.2.4.</span> <span class="toc-text">自定义权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-%E9%99%90%E6%B5%81Throttling"><span class="toc-number">12.3.</span> <span class="toc-text">11.3. 限流Throttling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">12.3.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E9%99%90%E6%B5%81%E7%B1%BB"><span class="toc-number">12.3.2.</span> <span class="toc-text">可选限流类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4-%E8%BF%87%E6%BB%A4Filtering"><span class="toc-number">12.4.</span> <span class="toc-text">11.4. 过滤Filtering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-5-%E6%8E%92%E5%BA%8FOrdering"><span class="toc-number">12.5.</span> <span class="toc-text">11.5. 排序Ordering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-6-%E5%88%86%E9%A1%B5Pagination"><span class="toc-number">12.6.</span> <span class="toc-text">11.6. 分页Pagination</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-7-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-Exceptions"><span class="toc-number">12.7.</span> <span class="toc-text">11.7. 异常处理 Exceptions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#REST-framework%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="toc-number">12.7.1.</span> <span class="toc-text">REST framework定义的异常</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-8-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number">12.8.</span> <span class="toc-text">11.8. 自动生成接口文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-8-1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">12.8.1.</span> <span class="toc-text">11.8.1. 安装依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-8-2-%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">12.8.2.</span> <span class="toc-text">11.8.2. 设置接口文档访问路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-8-3-%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E8%AF%B4%E6%98%8E%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE"><span class="toc-number">12.8.3.</span> <span class="toc-text">11.8.3. 文档描述说明的定义位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-8-4-%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%BD%91%E9%A1%B5"><span class="toc-number">12.8.4.</span> <span class="toc-text">11.8.4. 访问接口文档网页</span></a></li></ol></li></ol></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-DRF源码解析" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      DRF源码解析
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" class="article-date">
	  <time datetime="2024-07-01T01:35:59.000Z" itemprop="datePublished">2024-07-01</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/Django/" rel="tag">Django</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/#comments" class="article-comment-link">评论</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 17.2k(字)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 75(分)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=3 orderedList=false} -->

<!-- code_chunk_output -->

<ul>
<li><a href="#drf%E7%BB%84%E4%BB%B6">DRF组件</a></li>
<li><a href="#1-web%E5%BA%94%E7%94%A8%E6%A8%A1%E5%BC%8F">1. Web应用模式</a></li>
<li><a href="#2-api%E6%8E%A5%E5%8F%A3">2. api接口</a></li>
<li><a href="#3-restful-api%E8%A7%84%E8%8C%83">3. RESTful API规范</a><ul>
<li><a href="#%E5%B9%82%E7%AD%89%E6%80%A7">幂等性</a></li>
</ul>
</li>
<li><a href="#4-django%E7%9A%84cbv">4. Django的CBV</a><ul>
<li><a href="#41-cbv%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">4.1 CBV的简单使用</a></li>
<li><a href="#42-cbv%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90">4.2 CBV的源码解析</a><ul>
<li><a href="#421-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9F%A5%E8%AF%86%E7%82%B9%E5%9B%9E%E9%A1%BE">4.2.1 面向对象知识点回顾</a><ul>
<li><a href="#1%E7%BB%A7%E6%89%BF">(1)继承</a></li>
<li><a href="#2%E5%8F%8D%E5%B0%84">(2)反射</a></li>
</ul>
</li>
<li><a href="#422-cbv%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90">4.2.2 CBV的源码解析</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-django_rest_framework">5. Django_Rest_Framework</a></li>
<li><a href="#6-%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE">6. 环境安装与配置</a></li>
<li><a href="#7-drf%E7%9A%84apiview%E8%A7%86%E5%9B%BE">7. DRF的APIView视图</a><ul>
<li><a href="#71-apiview%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">7.1 APIView的简单使用</a></li>
<li><a href="#72-apiview%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90">7.2 APIView的源码解析</a></li>
<li><a href="#71%E8%AF%B7%E6%B1%82">7.1、请求</a><ul>
<li><a href="#711%E5%B8%B8%E7%94%A8%E5%B1%9E%E6%80%A7">7.1.1、常用属性</a><ul>
<li><a href="#1data">1).data</a></li>
<li><a href="#2query_params">2).query_params</a></li>
<li><a href="#3request_request">3)request._request</a></li>
</ul>
</li>
<li><a href="#712%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">7.1.2、基本使用</a></li>
</ul>
</li>
<li><a href="#72%E5%93%8D%E5%BA%94">7.2、响应</a><ul>
<li><a href="#721-%E6%9E%84%E9%80%A0%E6%96%B9%E5%BC%8F">7.2.1 构造方式</a></li>
<li><a href="#722-response%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%B1%9E%E6%80%A7">7.2.2 response对象的属性</a></li>
<li><a href="#723-%E7%8A%B6%E6%80%81%E7%A0%81">7.2.3 状态码</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#8-%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-serializer">8. 序列化器-Serializer</a><ul>
<li><a href="#81-%E5%AE%9A%E4%B9%89%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8">8.1 定义序列化器</a></li>
<li><a href="#82-%E5%88%9B%E5%BB%BAserializer%E5%AF%B9%E8%B1%A1">8.2 创建Serializer对象</a></li>
<li><a href="#83-%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8">8.3 序列化器的使用</a><ul>
<li><a href="#831-%E5%BA%8F%E5%88%97%E5%8C%96">8.3.1 序列化</a><ul>
<li><a href="#1%E5%9F%BA%E6%9C%AC%E5%BA%8F%E5%88%97%E5%8C%96">(1)基本序列化</a></li>
</ul>
</li>
<li><a href="#832--%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">8.3.2  反序列化</a><ul>
<li><a href="#1%E6%95%B0%E6%8D%AE%E9%AA%8C%E8%AF%81">(1)数据验证</a><ul>
<li><a href="#1-validate_%E5%AD%97%E6%AE%B5%E5%90%8D">(1) validate_字段名</a></li>
<li><a href="#2-validate">(2) validate</a></li>
</ul>
</li>
<li><a href="#2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE">(2)反序列化-保存数据</a></li>
<li><a href="#3-%E9%99%84%E5%8A%A0%E8%AF%B4%E6%98%8E">(3) 附加说明</a></li>
</ul>
</li>
<li><a href="#833%E5%9F%BA%E4%BA%8Eapiview%E7%9A%84%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0">8.3.3、基于APIView的接口实现</a></li>
</ul>
</li>
<li><a href="#84-%E6%A8%A1%E5%9E%8B%E7%B1%BB%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8">8.4 模型类序列化器</a><ul>
<li><a href="#1%E5%AE%9A%E4%B9%89">(1)定义</a></li>
<li><a href="#2%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5">(2)指定字段</a></li>
<li><a href="#3%E6%B7%BB%E5%8A%A0%E9%A2%9D%E5%A4%96%E5%8F%82%E6%95%B0">(3)添加额外参数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#9-%E8%A7%86%E5%9B%BE">9. 视图</a><ul>
<li><a href="#91genericapiview%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE%E7%B1%BB">9.1、GenericAPIView[通用视图类]</a><ul>
<li><a href="#1get_serializer_classself">(1)get_serializer_class(self)</a></li>
<li><a href="#2get_serializerself-args-kwargs">(2)get_serializer(self, *args, **kwargs)</a></li>
<li><a href="#3get_querysetself">(3)get_queryset(self)</a></li>
<li><a href="#4get_objectself">(4)get_object(self)</a></li>
</ul>
</li>
<li><a href="#925%E4%B8%AA%E8%A7%86%E5%9B%BE%E6%89%A9%E5%B1%95%E7%B1%BB">9.2、5个视图扩展类</a><ul>
<li><a href="#1listmodelmixin">(1)ListModelMixin</a></li>
<li><a href="#2createmodelmixin">（2）CreateModelMixin</a></li>
<li><a href="#3retrievemodelmixin">（3）RetrieveModelMixin</a></li>
<li><a href="#4updatemodelmixin">（4）UpdateModelMixin</a></li>
<li><a href="#5destroymodelmixin">（5）DestroyModelMixin</a></li>
</ul>
</li>
<li><a href="#93-genericapiview%E7%9A%84%E8%A7%86%E5%9B%BE%E5%AD%90%E7%B1%BB">9.3、 GenericAPIView的视图子类</a><ul>
<li><a href="#1createapiview">（1）CreateAPIView</a></li>
<li><a href="#2listapiview">（2）ListAPIView</a></li>
<li><a href="#3retrieveapiview">（3）RetrieveAPIView</a></li>
<li><a href="#4destoryapiview">（4）DestoryAPIView</a></li>
<li><a href="#5updateapiview">（5）UpdateAPIView</a></li>
<li><a href="#6listcreateapiview">（6）ListCreateAPIView</a></li>
<li><a href="#7retrieveupdateapiview">（7）RetrieveUpdateAPIView</a></li>
<li><a href="#8retrievedestoryapiview">（8）RetrieveDestoryAPIView</a></li>
<li><a href="#9retrieveupdatedestoryapiview">（9）RetrieveUpdateDestoryAPIView</a></li>
</ul>
</li>
<li><a href="#94%E8%A7%86%E5%9B%BE%E9%9B%86">9.4、视图集</a><ul>
<li><a href="#941viewset">9.4.1、ViewSet</a></li>
<li><a href="#942genericviewset">9.4.2、GenericViewSet</a></li>
<li><a href="#943modelviewset%E5%92%8Creadonlymodelviewset">9.4.3、ModelViewSet和ReadOnlyModelViewSet</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#10-%E8%B7%AF%E7%94%B1routers">10. 路由Routers</a><ul>
<li><a href="#101-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">10.1 使用方法</a></li>
<li><a href="#102-%E8%A7%86%E5%9B%BE%E9%9B%86%E4%B8%AD%E9%99%84%E5%8A%A0action%E7%9A%84%E5%A3%B0%E6%98%8E">10.2 视图集中附加action的声明</a></li>
<li><a href="#103-%E8%B7%AF%E7%94%B1router%E5%BD%A2%E6%88%90url%E7%9A%84%E6%96%B9%E5%BC%8F">10.3 路由router形成URL的方式</a></li>
</ul>
</li>
<li><a href="#11%E5%85%B6%E5%AE%83%E5%8A%9F%E8%83%BD%E7%BB%84%E4%BB%B6">11、其它功能组件</a><ul>
<li><a href="#111-%E8%AE%A4%E8%AF%81authentication">11.1. 认证Authentication</a></li>
<li><a href="#112-%E6%9D%83%E9%99%90permissions">11.2. 权限Permissions</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8">使用</a></li>
<li><a href="#%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9D%83%E9%99%90">提供的权限</a></li>
<li><a href="#%E4%B8%BE%E4%BE%8B">举例</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90">自定义权限</a></li>
</ul>
</li>
<li><a href="#113-%E9%99%90%E6%B5%81throttling">11.3. 限流Throttling</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">基本使用</a></li>
<li><a href="#%E5%8F%AF%E9%80%89%E9%99%90%E6%B5%81%E7%B1%BB">可选限流类</a></li>
</ul>
</li>
<li><a href="#114-%E8%BF%87%E6%BB%A4filtering">11.4. 过滤Filtering</a></li>
<li><a href="#115-%E6%8E%92%E5%BA%8Fordering">11.5. 排序Ordering</a></li>
<li><a href="#116-%E5%88%86%E9%A1%B5pagination">11.6. 分页Pagination</a></li>
<li><a href="#117-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-exceptions">11.7. 异常处理 Exceptions</a><ul>
<li><a href="#rest-framework%E5%AE%9A%E4%B9%89%E7%9A%84%E5%BC%82%E5%B8%B8">REST framework定义的异常</a></li>
</ul>
</li>
<li><a href="#118-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3">11.8. 自动生成接口文档</a><ul>
<li><a href="#1181-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96">11.8.1. 安装依赖</a></li>
<li><a href="#1182-%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84">11.8.2. 设置接口文档访问路径</a></li>
<li><a href="#1183-%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E8%AF%B4%E6%98%8E%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE">11.8.3. 文档描述说明的定义位置</a></li>
<li><a href="#1184-%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%BD%91%E9%A1%B5">11.8.4. 访问接口文档网页</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /code_chunk_output -->

<h1 id="DRF组件"><a href="#DRF组件" class="headerlink" title="DRF组件"></a>DRF组件</h1><h1 id="1-Web应用模式"><a href="#1-Web应用模式" class="headerlink" title="1. Web应用模式"></a>1. Web应用模式</h1><p>在开发Web应用中, 有两种应用模式:</p>
<ol>
<li>前后端不分离[客户端看到的内容和所有界面效果都是由服务端提供出来的]。</li>
</ol>
<img src="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/indepent_frontend_backend.png" class="" title="前后端不分离">
<ol start="2">
<li><p>前后端分离【把前端的界面效果(html，css，js分离到另一个服务端，python服务端只需要返回数据即可)】</p>
<p>前端形成一个独立的网站, 服务端构成一个独立的网站</p>
</li>
</ol>
<img src="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/indepent_frontend_backend-16318493319127.png" class="" title="前后端分离">

<h1 id="2-api接口"><a href="#2-api接口" class="headerlink" title="2. api接口"></a>2. api接口</h1><p>应用程序编程接口(Application Programming Interface, API接口), 就是应用程序对外提供了一个操作数据的入口, 这个入口可以是一个函数或类方法, 也可以是一个url地址或者一个网络地址. 当客户端调用这个入口, 应用程序则会执行对应代码操作, 给客户端完成相对应的功能.</p>
<p>当然, api接口在工作中是比较常见的开发内容, 有时候, 我们会调用其他人编写的api接口, 有时候, 我们也需要提供api接口给其他人操作. 由此就会带来一个问题, api接口往往都是一个函数、类方法、或者url或其他网络地址, 不断是哪一种, 当api接口编写过程中, 我们都要考虑一个问题就是这个接口应该怎么编写? 接口怎么写的更加容易维护和清晰, 这就需要大家在调用或者编写api接口的时候要有一个明确的编写规范!!!</p>
<p>为了在团队内部形成共识、防止个人习惯差异引起的混乱, 我们都需要找到一种大家都觉得很好的接口实现规范, 而且这种规范能够让后端写的接口, 用途一目了然, 减少客户端和服务端双方之间的合作成本.</p>
<p>目前市面上大部分公司开发人员使用的接口实现规范主要有:restful、RPC.</p>
<p>restful: 翻译成中文: <strong>资源状态转换</strong>.(表征性状态转移)</p>
<ul>
<li><p>把服务端提供的所有的数据&#x2F;文件都看成资源, 那么通过api接口请求数据的操作, 本质上来说就是对资源的操作了.</p>
<p>因此, restful中要求, 我们把当前接口对外提供哪种资源进行操作, 就把<strong>资源的名称写在url地址</strong>.</p>
</li>
<li><p>web开发中操作资源, 最常见的最通用的无非就是增删查改, 所以restful要求在地址栏中声明要操作的资源是什么. 然后通过<strong>http请求动词</strong>来说明对该资源进行哪一种操作</p>
<blockquote>
<p>POST <a target="_blank" rel="noopener" href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a>   添加学生数据</p>
<p>GET    <a target="_blank" rel="noopener" href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a>   获取所有学生</p>
<p>GET    <a target="_blank" rel="noopener" href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a><pk>&#x2F;     获取id&#x3D;pk的学生</p>
<p>DELETE <a target="_blank" rel="noopener" href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a><pk>&#x2F;   删除id&#x3D;pk的一个学生</p>
<p>PUT   <a target="_blank" rel="noopener" href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a><pk>&#x2F;       修改一个学生的全部信息 [id, name, sex, age, ]</p>
<p>PATCH  <a target="_blank" rel="noopener" href="http://www.xxx.com/api/students/">http://www.xxx.com/api/students/</a><pk>&#x2F;    修改一个学生的部分信息[age]</p>
</blockquote>
</li>
</ul>
<p>也就是说, 我们仅需要通过url地址上的资源名称结合HTTP请求动作, 就可以说明当前api接口的功能是什么了.restful是以资源为主的api接口规范, 体现在地址上就是资源就是以名词表达.</p>
<h1 id="3-RESTful-API规范"><a href="#3-RESTful-API规范" class="headerlink" title="3. RESTful API规范"></a>3. RESTful API规范</h1><img src="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/restful.gif" class="" title="restful">

<p>REST全称是Representational State Transfer, 中文意思是表述(编者注: 通常译为表征)性状态转移. 它首次出现在2000年Roy Fielding的博士论文中.</p>
<p>RESTful是一种专门为Web 开发而定义API接口的设计风格, 尤其适用于前后端分离的应用模式中.</p>
<p>这种风格的理念认为后端开发任务就是提供数据的, 对外提供的是数据资源的访问接口, 所以在定义接口时, 客户端访问的URL路径就表示这种要操作的数据资源.</p>
<p>而对于数据资源分别使用POST、DELETE、GET、UPDATE等请求动作来表达对数据的增删查改.</p>
<table>
<thead>
<tr>
<th>GET</th>
<th>&#x2F;students</th>
<th>获取所有学生</th>
</tr>
</thead>
<tbody><tr>
<td>请求方法</td>
<td>请求地址</td>
<td>后端操作</td>
</tr>
<tr>
<td>POST</td>
<td>&#x2F;students</td>
<td>增加学生</td>
</tr>
<tr>
<td>GET</td>
<td>&#x2F;students&#x2F;<pk></td>
<td>获取编号为pk的学生</td>
</tr>
<tr>
<td>PUT</td>
<td>&#x2F;students&#x2F;<pk></td>
<td>修改编号为pk的学生</td>
</tr>
<tr>
<td>DELETE</td>
<td>&#x2F;students&#x2F;<pk></td>
<td>删除编号为pk的学生</td>
</tr>
</tbody></table>
<p>restful规范是一种通用的规范, 不限制语言和开发框架的使用. 事实上, 我们可以使用任何一门语言, 任何一个框架都可以实现符合restful规范的API接口.</p>
<p>参考文档:<a target="_blank" rel="noopener" href="http://www.runoob.com/w3cnote/restful-architecture.html">http://www.runoob.com/w3cnote/restful-architecture.html</a></p>
<h3 id="幂等性"><a href="#幂等性" class="headerlink" title="幂等性"></a>幂等性</h3><p>接口实现过程中, 会存在<strong>幂等性</strong>. 所谓幂等性是指代<strong>客户端发起多次同样请求时, 是否对于服务端里面的资源产生不同结果</strong>. 如果<strong>多次请求</strong>, 服务端<strong>结果</strong>还是<strong>一样</strong>, 则属于<strong>幂等接口</strong>, 如果多次请求, 服务端产生结果是不一样的, 则属于<strong>非幂等接口</strong>.</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>是否幂等</th>
<th>是否安全</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>幂等</td>
<td>安全</td>
</tr>
<tr>
<td>POST</td>
<td>不幂等</td>
<td>不安全</td>
</tr>
<tr>
<td>PUT&#x2F;PATCH</td>
<td>幂等</td>
<td>不安全</td>
</tr>
<tr>
<td>DELETE</td>
<td>幂等</td>
<td>不安全</td>
</tr>
</tbody></table>
<h1 id="4-Django的CBV"><a href="#4-Django的CBV" class="headerlink" title="4. Django的CBV"></a>4. Django的CBV</h1><p>之前我们用的Django的视图函数叫FBV(也就是函数型视图函数), 这里我们来试试CBV(类视图函数)的写法. 类视图函数可以让代码看起来更简洁, 用起来更方便.</p>
<h2 id="4-1-CBV的简单使用"><a href="#4-1-CBV的简单使用" class="headerlink" title="4.1 CBV的简单使用"></a>4.1 CBV的简单使用</h2><p>视图类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;get请求book&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;post请求book&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>路由:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;book/&#x27;</span>, views.BookView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="4-2-CBV的源码解析"><a href="#4-2-CBV的源码解析" class="headerlink" title="4.2 CBV的源码解析"></a>4.2 CBV的源码解析</h2><h3 id="4-2-1-面向对象知识点回顾"><a href="#4-2-1-面向对象知识点回顾" class="headerlink" title="4.2.1 面向对象知识点回顾"></a>4.2.1 面向对象知识点回顾</h3><h4 id="1-继承"><a href="#1-继承" class="headerlink" title="(1)继承"></a>(1)继承</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.sleep()  <span class="comment"># 一定要明确self是谁</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sleep</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;sleeping...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wangwang</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;旺旺叫&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sleep</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;仰天睡...&quot;</span>)</span><br><span class="line"></span><br><span class="line">d = Dog(<span class="string">&quot;alex&quot;</span>, <span class="number">23</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-反射"><a href="#2-反射" class="headerlink" title="(2)反射"></a>(2)反射</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, init_func_str</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">        func = <span class="built_in">getattr</span>(self, init_func_str)</span><br><span class="line">        func()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sleep</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;sleeping...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">Animal</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wangwang</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;旺旺叫&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sleep</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;仰天睡...&quot;</span>)</span><br><span class="line"></span><br><span class="line">d = Dog(<span class="string">&quot;alex&quot;</span>, <span class="number">23</span>, <span class="string">&quot;sleep&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-CBV的源码解析"><a href="#4-2-2-CBV的源码解析" class="headerlink" title="4.2.2 CBV的源码解析"></a>4.2.2 CBV的源码解析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">class BookView(View):</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def get(self, request):</span></span><br><span class="line"><span class="string">        return HttpResponse(&quot;get请求book&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def post(self, request):</span></span><br><span class="line"><span class="string">        return HttpResponse(&quot;post请求book&quot;)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">class View:</span></span><br><span class="line"><span class="string">        @classonlymethod</span></span><br><span class="line"><span class="string">        def as_view(cls):</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">            def view(request):</span></span><br><span class="line"><span class="string">                self = cls()</span></span><br><span class="line"><span class="string">                return self.dispatch(request, *args, **kwargs)</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">            return view</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">      def dispatch(self, request):</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">            handler = getattr(self, request.method.lower()) # 按请求方式分发       </span></span><br><span class="line"><span class="string">            return handler(request, *args, **kwargs)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 路由</span></span><br><span class="line"><span class="string">path(&#x27;book/&#x27;, views.BookView.as_view()),</span></span><br><span class="line"><span class="string">path(&#x27;book/&#x27;, View.view),</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 一旦用户发起请求，比如get请求访问/book/，得到的是get方法的响应结果</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">get请求访问/book/  =&gt;  view()  =&gt;   dispatch()  =&gt;  get()  </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="5-Django-Rest-Framework"><a href="#5-Django-Rest-Framework" class="headerlink" title="5. Django_Rest_Framework"></a>5. Django_Rest_Framework</h1><p>核心思想: 大量缩减编写api接口的代码</p>
<p>Django REST framework是一个建立在Django基础之上的Web 应用开发框架, 可以快速的开发REST API接口应用. 在REST framework中, 提供了序列化器Serialzier的定义, 可以帮助我们简化序列化与反序列化的过程, 不仅如此, 还提供丰富的类视图、扩展类、视图集来简化视图的编写工作. REST framework还提供了认证、权限、限流、过滤、分页、接口文档等功能支持. REST framework提供了一个API 的Web可视化界面来方便查看测试接口.</p>
<img src="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/drf_logo-16318493501509.png" class="" title="drf_logo">

<p>中文文档:<a target="_blank" rel="noopener" href="https://q1mi.github.io/Django-REST-framework-documentation/#django-rest-framework">https://q1mi.github.io/Django-REST-framework-documentation/#django-rest-framework</a></p>
<p>github: <a target="_blank" rel="noopener" href="https://github.com/encode/django-rest-framework/tree/master">https://github.com/encode/django-rest-framework/tree/master</a></p>
<p>特点:</p>
<blockquote>
<ul>
<li>提供了定义序列化器Serializer的方法, 可以快速根据 Django ORM 或者其它库自动序列化&#x2F;反序列化; </li>
<li>提供了丰富的类视图、Mixin扩展类, 简化视图的编写; </li>
<li>丰富的定制层级: 函数视图、类视图、视图集合到自动生成 API, 满足各种需要; </li>
<li>多种身份认证和权限认证方式的支持; [jwt]</li>
<li>内置了限流系统; </li>
<li>直观的 API web 界面; 【方便我们调试开发api接口】</li>
<li>可扩展性, 插件丰富</li>
</ul>
</blockquote>
<h1 id="6-环境安装与配置"><a href="#6-环境安装与配置" class="headerlink" title="6. 环境安装与配置"></a>6. 环境安装与配置</h1><p>DRF需要以下依赖:</p>
<ul>
<li>Python (3.5 以上)</li>
<li>Django (2.2 以上)</li>
</ul>
<p><strong>DRF是以Django子应用的方式提供的, 所以我们可以直接利用已有的Django环境而无需从新创建.(若没有Django环境, 需要先创建环境安装Django)</strong></p>
<p>前提是已经安装了django, 建议安装在虚拟环境</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># conda create -n drfdemo python=3.8</span></span><br><span class="line"><span class="comment"># pip install django==3.2.4  -i https://pypi.douban.com/simple</span></span><br><span class="line"></span><br><span class="line">pip install djangorestframework -i https://pypi.douban.com/simple</span><br></pre></td></tr></table></figure>

<h1 id="7-DRF的APIView视图"><a href="#7-DRF的APIView视图" class="headerlink" title="7. DRF的APIView视图"></a>7. DRF的APIView视图</h1><h2 id="7-1-APIView的简单使用"><a href="#7-1-APIView的简单使用" class="headerlink" title="7.1 APIView的简单使用"></a>7.1 APIView的简单使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rest_framework.views.APIView</span><br></pre></td></tr></table></figure>

<p><code>APIView</code> 是REST framework提供的所有视图的基类, 继承自Django的 <code>View</code> 父类.</p>
<p>相较于CBV, 路由不变, 视图不变, 继承类改为 <code>APIView</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;APIView:get请求book&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;APIView:post请求book&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-2-APIView的源码解析"><a href="#7-2-APIView的源码解析" class="headerlink" title="7.2 APIView的源码解析"></a>7.2 APIView的源码解析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;APIView:get请求book&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;APIView:post请求book&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APIView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">as_view</span>(<span class="params">cls</span>):</span><br><span class="line">        view = <span class="built_in">super</span>().as_view()</span><br><span class="line">        view.cls = cls</span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># （1）构建新的request对象</span></span><br><span class="line">        request = self.initialize_request(request, *args, **kwargs)</span><br><span class="line">        self.request = request</span><br><span class="line">        <span class="comment"># （2）认证、权限、限流组件三件套</span></span><br><span class="line">        self.initial(request, *args, **kwargs)</span><br><span class="line">        <span class="comment"># （3）分发</span></span><br><span class="line">        handler = <span class="built_in">getattr</span>(self, request.method.lower()) <span class="comment"># 按请求方式分发       </span></span><br><span class="line">        <span class="keyword">return</span> handler(request, *args, **kwargs)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">View</span>:</span><br><span class="line"><span class="meta">    @classonlymethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">as_view</span>(<span class="params">cls</span>):</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">request</span>):</span><br><span class="line">            self = cls()</span><br><span class="line">            <span class="keyword">return</span> self.dispatch(request, *args, **kwargs)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> view</span><br><span class="line">            </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request</span>):</span><br><span class="line">        </span><br><span class="line">        handler = <span class="built_in">getattr</span>(self, request.method.lower()) <span class="comment"># 按请求方式分发       </span></span><br><span class="line">        <span class="keyword">return</span> handler(request, *args, **kwargs)</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line"><span class="comment"># 路由</span></span><br><span class="line">path(<span class="string">&#x27;book/&#x27;</span>, views.BookView.as_view()),</span><br><span class="line">path(<span class="string">&#x27;book/&#x27;</span>, View.view),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一旦用户发起请求，比如get请求访问/book/,依然得到get方法的响应</span></span><br><span class="line">get请求访问/book/ =&gt; View.view()  =&gt;   APIView.dispatch()  =&gt;  BookView.get()  </span><br></pre></td></tr></table></figure>

<p><code>APIView</code> 与 <code>View</code> 的不同之处在于:</p>
<blockquote>
<ul>
<li>传入到视图方法中的是REST framework的 <code>Request</code> 对象, 而不是Django的 <code>HttpRequeset</code> 对象; </li>
<li>视图方法可以返回REST framework的 <code>Response</code> 对象, 视图会为响应数据设置(render)符合前端期望要求的格式; </li>
<li>任何 <code>APIException</code> 异常都会被捕获到, 并且处理成合适格式的响应信息返回给客户端; </li>
<li>重新声明了一个新的as_views方法并在dispatch()进行路由分发前, 会对请求的客户端进行身份认证、权限检查、流量控制.</li>
</ul>
</blockquote>
<p>DRF在django原有的基础上, 新增了一个request对象继承到了APIVIew视图类, 并在django原有的HttpResponse响应类的基础上实现了一个子类rest_framework.response. Response响应类. 这两个类, 都是基于内容协商来完成数据的格式转换的.</p>
<blockquote>
<p>request-&gt;parser-&gt;识别客户端请求头中的Content-Type来完成数据转换成-&gt;类字典(QueryDict, 字典的子类)</p>
<p>response-&gt;renderer-&gt;识别客户端请求头的”Accept”来提取客户单期望的返回数据格式, -&gt; 转换成客户端的期望格式数据</p>
</blockquote>
<h2 id="7-1、请求"><a href="#7-1、请求" class="headerlink" title="7.1、请求"></a>7.1、请求</h2><p>REST framework 传入视图的request对象不再是Django默认的HttpRequest对象, 而是REST framework提供的扩展了HttpRequest类的<strong>Request</strong>类的对象.</p>
<p>REST framework 提供了<strong>Parser</strong>解析器, 在接收到请求后会自动根据Content-Type指明的请求数据类型(如JSON、表单等)将请求数据进行parse解析, 解析为类字典[QueryDict]对象保存到<strong>Request</strong>对象中.</p>
<p><strong>Request对象的数据是自动根据前端发送数据的格式进行解析之后的结果.</strong></p>
<p>无论前端发送的哪种格式的数据, 我们都可以以统一的方式读取数据.</p>
<h3 id="7-1-1、常用属性"><a href="#7-1-1、常用属性" class="headerlink" title="7.1.1、常用属性"></a>7.1.1、常用属性</h3><h4 id="1-data"><a href="#1-data" class="headerlink" title="1).data"></a>1).data</h4><p><code>request.data</code> 返回解析之后的请求体数据. 类似于Django中标准的 <code>request.POST</code> 和 <code>request.FILES</code> 属性, 但提供如下特性:</p>
<ul>
<li>包含了解析之后的文件和非文件数据</li>
<li>包含了对POST、PUT、PATCH请求方式解析后的数据</li>
<li>利用了REST framework的parsers解析器, 不仅支持表单类型数据, 也支持JSON数据</li>
</ul>
<h4 id="2-query-params"><a href="#2-query-params" class="headerlink" title="2).query_params"></a>2).query_params</h4><p><code>request.query_params</code> 与Django标准的 <code>request.GET</code> 相同, 只是更换了更正确的名称而已.</p>
<h4 id="3-request-request"><a href="#3-request-request" class="headerlink" title="3)request._request"></a>3)request._request</h4><p>获取django封装的Request对象</p>
<h3 id="7-1-2、基本使用"><a href="#7-1-2、基本使用" class="headerlink" title="7.1.2、基本使用"></a>7.1.2、基本使用</h3><p>视图代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"><span class="keyword">from</span> django.http.response <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> django.http.request <span class="keyword">import</span> HttpRequest</span><br><span class="line"><span class="keyword">from</span> django.core.handlers.wsgi <span class="keyword">import</span> WSGIRequest</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReqView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="built_in">print</span>(request)</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&quot;ok&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">默认情况下, 编写视图类时，如果继承的是django内置的django.view.View视图基类，</span></span><br><span class="line"><span class="string">则视图方法中得到的request对象，是django默认提供的django.core.handlers.wsgi.WSGIRequest</span></span><br><span class="line"><span class="string">WSGIRequest这个请求处理对象，无法直接提供的关于json数据数据处理。</span></span><br><span class="line"><span class="string">在编写api接口时很不方便，所以drf为了简写这块内容，在原来的HttpRequest的基础上面，新增了一个Request对象</span></span><br><span class="line"><span class="string">这个Request对象是单独声明的和原来django的HttpRequest不是父子关系。</span></span><br><span class="line"><span class="string">同时注意：</span></span><br><span class="line"><span class="string">   要使用drf提供的Request请求处理对象，必须在编写视图类时继承drf提供的视图基类</span></span><br><span class="line"><span class="string">   from rest_framework.views import APIView</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   如果使用drf提供的视图基类APIView编写类视图，则必须使用来自drf提供的Request请求对象和Response响应对象</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReqAPIView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="comment"># rest_framework.request.Request对象</span></span><br><span class="line">        <span class="built_in">print</span>(request) <span class="comment"># &lt;rest_framework.request.Request: GET &#x27;/req/req2?name=xiaoming&amp;age=17&amp;lve=swim&amp;lve=code&#x27;&gt;</span></span><br><span class="line">        <span class="comment"># 获取查询字符串</span></span><br><span class="line">        <span class="built_in">print</span>(request.query_params)</span><br><span class="line">        <span class="comment"># 没有参数情况下： &lt;QueryDict: &#123;&#125;&gt;</span></span><br><span class="line">        <span class="comment"># 有参数的情况下： &lt;QueryDict: &#123;&#x27;name&#x27;: [&#x27;xiaoming&#x27;], &#x27;age&#x27;: [&#x27;17&#x27;], &#x27;lve&#x27;: [&#x27;swim&#x27;, &#x27;code&#x27;]&#125;&gt;</span></span><br><span class="line">        <span class="comment"># 所以，request.query_params的返回值操作和原来在django里面是一模一样的</span></span><br><span class="line">        <span class="built_in">print</span>(request.query_params.get(<span class="string">&quot;name&quot;</span>)) <span class="comment"># xiaoming</span></span><br><span class="line">        <span class="built_in">print</span>(request.query_params.getlist(<span class="string">&quot;lve&quot;</span>)) <span class="comment"># [&#x27;swim&#x27;, &#x27;code&#x27;]</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&quot;ok&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># 获取请求体</span></span><br><span class="line">        <span class="built_in">print</span>(request.data) <span class="comment"># &#123;&#x27;name&#x27;: &#x27;xiaoming&#x27;, &#x27;age&#x27;: 16, &#x27;lve&#x27;: [&#x27;swim&#x27;, &#x27;code&#x27;]&#125;</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;直接从请求体中提取数据转</span></span><br><span class="line"><span class="string">        # 客户端如果上传了json数据，直接返回字典</span></span><br><span class="line"><span class="string">        &#123;&#x27;name&#x27;: &#x27;灰太狼&#x27;, &#x27;age&#x27;: 20, &#x27;sex&#x27;: 1, &#x27;classmate&#x27;: &#x27;301&#x27;, &#x27;description&#x27;: &#x27;我还会再回来的~&#x27;&#125;</span></span><br><span class="line"><span class="string">        # 客户端如果上传了表单数据，直接返回QueryDict</span></span><br><span class="line"><span class="string">        &lt;QueryDict: &#123;&#x27;name&#x27;: [&#x27;xiaohui&#x27;], &#x27;age&#x27;: [&#x27;18&#x27;]&#125;&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(request.FILES) <span class="comment"># 获取上传文件列表</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 要获取django原生提供的HttpRequest对象，可以通过request._request来获取到</span></span><br><span class="line">        <span class="built_in">print</span>(request._request.META.get(<span class="string">&quot;Accept&quot;</span>)) <span class="comment"># 当值为None时，drf默认在响应数据时按json格式返回</span></span><br><span class="line">        <span class="comment"># response = Response(data=&quot;not ok&quot;, status=204, headers=&#123;&quot;Company&quot;:&quot;Oldboy&quot;&#125;)</span></span><br><span class="line">        response = Response(data=<span class="string">&quot;not ok&quot;</span>, status=status.HTTP_400_BAD_REQUEST, headers=&#123;<span class="string">&quot;Company&quot;</span>:<span class="string">&quot;Oldboy&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h2 id="7-2、响应"><a href="#7-2、响应" class="headerlink" title="7.2、响应"></a>7.2、响应</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rest_framework.response.Response</span><br></pre></td></tr></table></figure>

<p>REST framework提供了一个响应类 <code>Response</code> , 使用该类构造响应对象时, 响应的具体数据内容会被转换(render渲染器)成符合前端需求的类型.</p>
<p>REST framework提供了 <code>Renderer</code> 渲染器, 用来根据请求头中的 <code>Accept</code> (接收数据类型声明)来自动转换响应数据到对应格式. 如果前端请求中未进行Accept声明, 则会采用Content-Type方式处理响应数据, 我们可以通过配置来修改默认响应格式.</p>
<p>可以在<strong>rest_framework.settings</strong>查找所有的drf默认配置项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;DEFAULT_RENDERER_CLASSES&#x27;</span>: (  <span class="comment"># 默认响应渲染类</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.JSONRenderer&#x27;</span>,  <span class="comment"># json渲染器，返回json数据</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;</span>,  <span class="comment"># 浏览器API渲染器，返回调试界面</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-1-构造方式"><a href="#7-2-1-构造方式" class="headerlink" title="7.2.1 构造方式"></a>7.2.1 构造方式</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Response(data, status=<span class="literal">None</span>, template_name=<span class="literal">None</span>, headers=<span class="literal">None</span>, content_type=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>drf的响应处理类和请求处理类不一样, Response就是django的HttpResponse响应处理类的子类.</p>
<p><code>data</code> 数据不要是render处理之后的数据, 只需传递python的内建类型数据即可, REST framework会使用 <code>renderer</code> 渲染器处理 <code>data</code> .</p>
<p><code>data</code> 不能是复杂结构的数据, 如Django的模型类对象, 对于这样的数据我们可以使用 <code>Serializer</code> 序列化器序列化处理后(转为了Python字典类型)再传递给 <code>data</code> 参数.</p>
<p>参数说明:</p>
<blockquote>
<ul>
<li><code>data</code> : 为响应准备的序列化处理后的数据; </li>
<li><code>status</code> : 状态码, 默认200; </li>
<li><code>template_name</code> : 模板名称, 如果使用 <code>HTMLRenderer</code> 时需指明; </li>
<li><code>headers</code> : 用于存放响应头信息的字典; </li>
<li><code>content_type</code> : 响应数据的Content-Type, 通常此参数无需传递, REST framework会根据前端所需类型数据来设置该参数</li>
</ul>
</blockquote>
<h4 id="7-2-2-response对象的属性"><a href="#7-2-2-response对象的属性" class="headerlink" title="7.2.2 response对象的属性"></a>7.2.2 response对象的属性</h4><blockquote>
<p>.data: 传给response对象的序列化后, 但尚未render处理的数据</p>
<p>.status_code: 状态码的数字</p>
<p>.content: 经过render处理后的响应数据</p>
</blockquote>
<h4 id="7-2-3-状态码"><a href="#7-2-3-状态码" class="headerlink" title="7.2.3 状态码"></a>7.2.3 状态码</h4><p>为了方便设置状态码, REST framewrok在 <code>rest_framework.status</code> 模块中提供了常用http状态码的常量.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&#x27;&#x27; 1）信息告知 - 1xx &#x27;&#x27;&#x27;</span><br><span class="line">HTTP_100_CONTINUE</span><br><span class="line">HTTP_101_SWITCHING_PROTOCOLS</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27; 2）成功 - 2xx&#x27;&#x27;&#x27;</span><br><span class="line">HTTP_200_OK</span><br><span class="line">HTTP_201_CREATED</span><br><span class="line">HTTP_202_ACCEPTED</span><br><span class="line">HTTP_203_NON_AUTHORITATIVE_INFORMATION</span><br><span class="line">HTTP_204_NO_CONTENT</span><br><span class="line">HTTP_205_RESET_CONTENT</span><br><span class="line">HTTP_206_PARTIAL_CONTENT</span><br><span class="line">HTTP_207_MULTI_STATUS</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27; 3）重定向 - 3xx&#x27;&#x27;&#x27;</span><br><span class="line">HTTP_300_MULTIPLE_CHOICES</span><br><span class="line">HTTP_301_MOVED_PERMANENTLY</span><br><span class="line">HTTP_302_FOUND</span><br><span class="line">HTTP_303_SEE_OTHER</span><br><span class="line">HTTP_304_NOT_MODIFIED</span><br><span class="line">HTTP_305_USE_PROXY</span><br><span class="line">HTTP_306_RESERVED</span><br><span class="line">HTTP_307_TEMPORARY_REDIRECT</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27; 4）客户端错误 - 4xx&#x27;&#x27;&#x27;</span><br><span class="line">HTTP_400_BAD_REQUEST</span><br><span class="line">HTTP_401_UNAUTHORIZED</span><br><span class="line">HTTP_402_PAYMENT_REQUIRED</span><br><span class="line">HTTP_403_FORBIDDEN</span><br><span class="line">HTTP_404_NOT_FOUND</span><br><span class="line">HTTP_405_METHOD_NOT_ALLOWED</span><br><span class="line">HTTP_406_NOT_ACCEPTABLE</span><br><span class="line">HTTP_407_PROXY_AUTHENTICATION_REQUIRED</span><br><span class="line">HTTP_408_REQUEST_TIMEOUT</span><br><span class="line">HTTP_409_CONFLICT</span><br><span class="line">HTTP_410_GONE</span><br><span class="line">HTTP_411_LENGTH_REQUIRED</span><br><span class="line">HTTP_412_PRECONDITION_FAILED</span><br><span class="line">HTTP_413_REQUEST_ENTITY_TOO_LARGE</span><br><span class="line">HTTP_414_REQUEST_URI_TOO_LONG</span><br><span class="line">HTTP_415_UNSUPPORTED_MEDIA_TYPE</span><br><span class="line">HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE</span><br><span class="line">HTTP_417_EXPECTATION_FAILED</span><br><span class="line">HTTP_422_UNPROCESSABLE_ENTITY</span><br><span class="line">HTTP_423_LOCKED</span><br><span class="line">HTTP_424_FAILED_DEPENDENCY</span><br><span class="line">HTTP_428_PRECONDITION_REQUIRED</span><br><span class="line">HTTP_429_TOO_MANY_REQUESTS</span><br><span class="line">HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE</span><br><span class="line">HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27; 5）服务器错误 - 5xx&#x27;&#x27;&#x27;</span><br><span class="line">HTTP_500_INTERNAL_SERVER_ERROR</span><br><span class="line">HTTP_501_NOT_IMPLEMENTED</span><br><span class="line">HTTP_502_BAD_GATEWAY</span><br><span class="line">HTTP_503_SERVICE_UNAVAILABLE</span><br><span class="line">HTTP_504_GATEWAY_TIMEOUT</span><br><span class="line">HTTP_505_HTTP_VERSION_NOT_SUPPORTED</span><br><span class="line">HTTP_507_INSUFFICIENT_STORAGE</span><br><span class="line">HTTP_511_NETWORK_AUTHENTICATION_REQUIRED</span><br></pre></td></tr></table></figure>

<h1 id="8-序列化器-Serializer"><a href="#8-序列化器-Serializer" class="headerlink" title="8. 序列化器-Serializer"></a>8. 序列化器-Serializer</h1><p>作用:</p>
<pre><code>1. 序列化,序列化器会把模型对象转换成字典,经过response以后变成json字符串
2. 反序列化,把客户端发送过来的数据,经过request以后变成字典,序列化器可以把字典转成模型
3. 反序列化,完成数据校验功能
</code></pre>
<h2 id="8-1-定义序列化器"><a href="#8-1-定义序列化器" class="headerlink" title="8.1 定义序列化器"></a>8.1 定义序列化器</h2><p>Django REST framework中的Serializer使用类来定义, 须继承自rest_framework.serializers. Serializer.</p>
<p>接下来, 为了方便演示序列化器的使用, 我们先创建一个新的子应用sers</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp sers</span><br></pre></td></tr></table></figure>

<p>我们创建几个图书相关模型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; Create your models here.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>(models.Model):</span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>,verbose_name=<span class="string">&quot;书籍名称&quot;</span>)</span><br><span class="line">    price = models.IntegerField(verbose_name=<span class="string">&quot;价格&quot;</span>)</span><br><span class="line">    pub_date = models.DateField(verbose_name=<span class="string">&quot;出版日期&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>我们想为Book模型类提供一个序列化器, 可以定义如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.Serializer):</span><br><span class="line">    title = serializers.CharField()</span><br><span class="line">    price = serializers.IntegerField()</span><br><span class="line">    pub_date = serializers.DateField()</span><br></pre></td></tr></table></figure>

<p>**注意:serializer不是只能为数据库模型类定义, 也可以为非数据库模型类的数据定义.**serializer是独立于数据库之外的存在.</p>
<h2 id="8-2-创建Serializer对象"><a href="#8-2-创建Serializer对象" class="headerlink" title="8.2 创建Serializer对象"></a>8.2 创建Serializer对象</h2><p>定义好Serializer类后, 就可以创建Serializer对象了.</p>
<p>Serializer的构造方法为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Serializer(instance=<span class="literal">None</span>, data=empty, **kwarg)</span><br></pre></td></tr></table></figure>

<p>说明:</p>
<p>1)用于序列化时, 将模型类对象传入<strong>instance</strong>参数</p>
<p>2)用于反序列化时, 将要被反序列化的数据传入<strong>data</strong>参数</p>
<p>3)除了instance和data参数外, 在构造Serializer对象时, 还可通过<strong>context</strong>参数额外添加数据, 如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serializer = AccountSerializer(account, context=&#123;<span class="string">&#x27;request&#x27;</span>: request&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>通过context参数附加的数据, 可以通过Serializer对象的context属性获取.</strong></p>
<blockquote>
<ol>
<li>使用序列化器的时候一定要注意, 序列化器声明了以后, 不会自动执行, 需要我们在视图中进行调用才可以.</li>
<li>序列化器无法直接接收数据, 需要我们在视图中创建序列化器对象时把使用的数据传递过来.</li>
<li>序列化器的字段声明类似于我们前面使用过的表单系统.</li>
<li>开发restful api时, 序列化器会帮我们把模型数据转换成字典.</li>
<li>drf提供的视图会帮我们把字典转换成json, 或者把客户端发送过来的数据转换字典.</li>
</ol>
</blockquote>
<h2 id="8-3-序列化器的使用"><a href="#8-3-序列化器的使用" class="headerlink" title="8.3 序列化器的使用"></a>8.3 序列化器的使用</h2><p>序列化器的使用分两个阶段:</p>
<ol>
<li>处理客户端请求时，使用序列化器可以完成对数据的反序列化。</li>
<li>处理服务器响应时，使用序列化器可以完成对数据的序列化。</li>
</ol>
<h3 id="8-3-1-序列化"><a href="#8-3-1-序列化" class="headerlink" title="8.3.1 序列化"></a>8.3.1 序列化</h3><h4 id="1-基本序列化"><a href="#1-基本序列化" class="headerlink" title="(1)基本序列化"></a>(1)基本序列化</h4><p>《1》 先查询出一个学生对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sers.models <span class="keyword">import</span> Book</span><br><span class="line">book = Book.objects.get(pk=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>《2》 构造序列化器对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> BookSerializer</span><br><span class="line">bookSer = BookSerializer(instance=book)</span><br></pre></td></tr></table></figure>

<p>《3》获取序列化数据</p>
<p>通过data属性可以获取序列化后的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bookSer.data </span><br><span class="line"><span class="comment"># &#123;&#x27;title&#x27;: &#x27;乱世佳人&#x27;, &#x27;price&#x27;: 335, &#x27;pub_date&#x27;: &#x27;2012-12-12&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<p>路由视图代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># urls.py</span></span><br><span class="line"></span><br><span class="line">path(<span class="string">&quot;sers/&quot;</span>, include(<span class="string">&quot;sers.urls&quot;</span>)), </span><br><span class="line"></span><br><span class="line"><span class="comment"># sers.urls</span></span><br><span class="line"></span><br><span class="line">path(<span class="string">&#x27;books/(\d+)&#x27;</span>, BookView.as_view()), </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .sers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request,<span class="built_in">id</span></span>):</span><br><span class="line">        book = Book.objects.get(pk=<span class="built_in">id</span>)</span><br><span class="line">        bs = BookSerializer(instance=book)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br></pre></td></tr></table></figure>

<p>《5》如果要被序列化的是包含多条数据的查询集QuerySet, 可以通过添加<strong>many&#x3D;True</strong>参数补充说明</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="comment"># book = Book.objects.get(pk=1)</span></span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        bs = BookSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br></pre></td></tr></table></figure>

<h3 id="8-3-2-反序列化"><a href="#8-3-2-反序列化" class="headerlink" title="8.3.2  反序列化"></a>8.3.2  反序列化</h3><h4 id="1-数据验证"><a href="#1-数据验证" class="headerlink" title="(1)数据验证"></a>(1)数据验证</h4><p>使用序列化器进行反序列化时, 需要对数据进行验证后, 才能获取验证成功的数据或保存成模型类对象.</p>
<p>在获取反序列化的数据前, 必须调用**is_valid()**方法进行验证, 验证成功返回True, 否则返回False.</p>
<p>验证失败, 可以通过序列化器对象的<strong>errors</strong>属性获取错误信息, 返回字典, 包含了字段和字段的错误. 如果是非字段错误, 可以通过修改REST framework配置中的<strong>NON_FIELD_ERRORS_KEY</strong>来控制错误字典中的键名.</p>
<p>验证成功, 可以通过序列化器对象的<strong>validated_data</strong>属性获取数据.</p>
<p>在定义序列化器时, 指明每个字段的序列化类型和选项参数, 本身就是一种验证行为.</p>
<p>通过构造序列化器对象, 并将要反序列化的数据传递给data构造参数, 进而进行验证.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sers.sers <span class="keyword">import</span> BookSerializer</span><br><span class="line">bs = BookSerializer(data=&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;小王子&quot;</span>,<span class="string">&quot;price&quot;</span>:<span class="number">100</span>&#125;)</span><br><span class="line">bs.is_valid()  <span class="comment"># 必须先要is_valid,才会有bs.validated_data和bs.errors</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line">bs.validated_data</span><br><span class="line">&#123;&#125;</span><br><span class="line">bs.errors</span><br><span class="line">&#123;<span class="string">&#x27;pub_date&#x27;</span>: [ErrorDetail(string=<span class="string">&#x27;This field is required.&#x27;</span>, code=<span class="string">&#x27;required&#x27;</span>)]&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以设置required&#x3D;False让校验字段可以为空!</p>
</blockquote>
<p>is_valid()方法还可以在验证失败时抛出异常serializers. ValidationError, 可以通过传递<strong>raise_exception&#x3D;True</strong>参数开启, REST framework接收到此异常, 会向前端返回HTTP 400 Bad Request响应.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Return a 400 response if the data was invalid.serializer.is_valid(raise_exception=True)</span></span><br></pre></td></tr></table></figure>

<p>如果觉得这些还不够, 需要再补充定义验证行为, 可以使用以下三种方法:</p>
<h5 id="1-validate-字段名"><a href="#1-validate-字段名" class="headerlink" title="(1) validate_字段名"></a>(1) validate_字段名</h5><p>对 <code>&lt;field_name&gt;</code> 字段进行验证, 如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.Serializer):</span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price = serializers.IntegerField(required=<span class="literal">True</span>)</span><br><span class="line">    pub_date = serializers.DateField(required=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_title</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;django&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> value.lower():</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&quot;图书不是关于Django的&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sers.sers <span class="keyword">import</span> BookSerializer</span><br><span class="line">bs = BookSerializer(data=&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;小王子&quot;</span>,<span class="string">&quot;price&quot;</span>:<span class="number">100</span>&#125;)</span><br><span class="line">bs.is_valid()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line">bs.errors</span><br><span class="line">&#123;<span class="string">&#x27;title&#x27;</span>: [ErrorDetail(string=<span class="string">&#x27;图书不是关于Django的&#x27;</span>, code=<span class="string">&#x27;invalid&#x27;</span>)], <span class="string">&#x27;pub_date&#x27;</span>: [ErrorDetail(string=<span class="string">&#x27;This field is required.&#x27;</span>, code=<span class="string">&#x27;required&#x27;</span>)]&#125;</span><br></pre></td></tr></table></figure>

<p>还有一种写法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">title_django</span>(<span class="params">self, value</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;django&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> value.lower():</span><br><span class="line">        <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&quot;图书不是关于Django的&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers. Serializer):</span><br><span class="line"></span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">32</span>,validators=[title_django,])</span><br><span class="line">    ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-validate"><a href="#2-validate" class="headerlink" title="(2) validate"></a>(2) validate</h5><p>在序列化器中需要同时对多个字段进行比较验证时，可以定义validate方法来验证，如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.Serializer):</span><br><span class="line">    title = serializers.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price = serializers.IntegerField(required=<span class="literal">False</span>)</span><br><span class="line">    pub_date = serializers.DateField(required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    bread = serializers.IntegerField(label=<span class="string">&#x27;阅读量&#x27;</span>, max_value=<span class="number">2147483647</span>, min_value=-<span class="number">2147483648</span>, required=<span class="literal">False</span>)</span><br><span class="line">    bcomment = serializers.IntegerField(label=<span class="string">&#x27;评论量&#x27;</span>, max_value=<span class="number">2147483647</span>, min_value=-<span class="number">2147483648</span>, required=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate_title</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;django&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> value.lower():</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&quot;图书不是关于Django的&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validate</span>(<span class="params">self, data</span>):</span><br><span class="line">        bread = data.get(<span class="string">&quot;bread&quot;</span>)</span><br><span class="line">        bcomment = data.get(<span class="string">&quot;bcomment&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> bread &lt; bcomment:</span><br><span class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">&#x27;阅读量小于评论量&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bs = BookSerializer(data=&#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;Django深入浅出&quot;</span>,<span class="string">&quot;bread&quot;</span>:<span class="number">100</span>,<span class="string">&quot;bcomment&quot;</span>:<span class="number">200</span>,<span class="string">&quot;publish_id&quot;</span>:<span class="number">1</span>&#125;)</span><br><span class="line">bs.is_valid()</span><br><span class="line"><span class="literal">False</span></span><br><span class="line">bs.errors</span><br><span class="line">&#123;<span class="string">&#x27;non_field_errors&#x27;</span>: [ErrorDetail(string=<span class="string">&#x27;阅读量小于评论量&#x27;</span>, code=<span class="string">&#x27;invalid&#x27;</span>)]&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-反序列化-保存数据"><a href="#2-反序列化-保存数据" class="headerlink" title="(2)反序列化-保存数据"></a>(2)反序列化-保存数据</h4><p>前面的验证数据成功后, 我们可以使用序列化器来完成数据反序列化的过程. 这个过程可以把数据转成模型类对象.</p>
<p>可以通过实现create()和update()两个方法来实现.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.Serializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, validated_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;新建&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, instance, validated_data</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> instance</span><br></pre></td></tr></table></figure>

<p>实现了上述两个方法后, 在反序列化数据的时候, 就可以通过save()方法返回一个数据对象实例了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book = serializer.save()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>1、如果创建序列化器对象的时候, 没有传递instance实例, 则调用save()方法的时候, create()被调用</p>
<p>2、相反, 如果传递了instance实例, 则调用save()方法的时候, update()被调用.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path , include</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sers.views <span class="keyword">import</span> BookView, BookDetailView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, BookView.as_view()),</span><br><span class="line">    re_path(<span class="string">&#x27;books/(?P&lt;pk&gt;\d+)/&#x27;</span>, BookDetailView.as_view()),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 序列化器</span></span><br><span class="line"><span class="comment"># 声明序列化器，所有的序列化器都要直接或者间接继承于 Serializer</span></span><br><span class="line"><span class="comment"># 其中，ModelSerializer是Serializer的子类，ModelSerializer在Serializer的基础上进行了代码简化</span></span><br></pre></td></tr></table></figure>

<h4 id="3-附加说明"><a href="#3-附加说明" class="headerlink" title="(3) 附加说明"></a>(3) 附加说明</h4><ol>
<li>在对序列化器进行save()保存时, 可以额外传递数据, 这些数据可以在create()和update()中的validated_data参数获取到</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># request.user 是django中记录当前登录用户的模型对象serializer.save(owner=request.user)</span></span><br></pre></td></tr></table></figure>

<p>2)默认序列化器必须传递所有required的字段, 否则会抛出验证异常. 但是我们可以使用partial参数来允许部分字段更新</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Update `comment` with partial dataserializer = CommentSerializer(comment, data=&#123;&#x27;content&#x27;: u&#x27;foo bar&#x27;&#125;, partial=True)</span></span><br></pre></td></tr></table></figure>

<h3 id="8-3-3、基于APIView的接口实现"><a href="#8-3-3、基于APIView的接口实现" class="headerlink" title="8.3.3、基于APIView的接口实现"></a>8.3.3、基于APIView的接口实现</h3><p>路由:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;book/&#x27;</span>, views.BookView.as_view()),</span><br><span class="line">    re_path(<span class="string">&#x27;book/(\d+)&#x27;</span>, views.BookDetailView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>视图:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27; Create your views here.&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;设计增删改查查接口&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;序列化器&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.Serializer):</span><br><span class="line">    title = serializers.CharField()</span><br><span class="line">    price = serializers.IntegerField()</span><br><span class="line">    pub_date = serializers.DateField()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, validated_data</span>):</span><br><span class="line">        new_book = Book.objects.create(**validated_data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> new_book</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, instance, validated_data</span>):</span><br><span class="line">        Book.objects.<span class="built_in">filter</span>(pk=instance.pk).update(**validated_data)</span><br><span class="line">        instance = Book.objects.get(pk=instance.pk)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;视图&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        bs = BookSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        bs = BookSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        book = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=book)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        instance = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=instance, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        Book.objects.get(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response()</span><br></pre></td></tr></table></figure>

<h2 id="8-4-模型类序列化器"><a href="#8-4-模型类序列化器" class="headerlink" title="8.4 模型类序列化器"></a>8.4 模型类序列化器</h2><p>如果我们想要使用序列化器对应的是Django的模型类, DRF为我们提供了ModelSerializer模型类序列化器来帮助我们快速创建一个Serializer类.</p>
<p>ModelSerializer与常规的Serializer相同, 但提供了:</p>
<ul>
<li>基于模型类自动生成一系列字段</li>
<li>基于模型类自动为Serializer生成validators, 比如unique_together</li>
<li>包含默认的create()和update()的实现</li>
</ul>
<h4 id="1-定义"><a href="#1-定义" class="headerlink" title="(1)定义"></a>(1)定义</h4><p>比如我们创建一个BookInfoSerializer</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers. ModelSerializer):</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>model 指明参照哪个模型类</li>
<li>fields 指明为模型类的哪些字段生成</li>
</ul>
<p>我们可以在python manage.py shell中查看自动生成的BookSerializer的具体实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;视图&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        bs = BookSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        bs = BookSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        book = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=book)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        instance = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=instance, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        Book.objects.get(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意, 只有序列化器改为BookSerializer, 其他部分都没动</p>
</blockquote>
<h4 id="2-指定字段"><a href="#2-指定字段" class="headerlink" title="(2)指定字段"></a>(2)指定字段</h4><ol>
<li>使用<strong>fields</strong>来明确字段, <code>__all__</code> 表名包含所有字段, 也可以写明具体哪些字段, 如</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span></span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;pub_date&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用<strong>exclude</strong>可以明确排除掉哪些字段</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        exclude = (<span class="string">&#x27;pub_date&#x27;</span>,)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>指明只读字段</li>
</ol>
<p>可以通过<strong>read_only_fields</strong>指明只读字段, 即仅用于序列化输出的字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;pub_date&#x27;</span>， <span class="string">&#x27;bread&#x27;</span>, <span class="string">&#x27;bcomment&#x27;</span>)</span><br><span class="line">        read_only_fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;bread&#x27;</span>, <span class="string">&#x27;bcomment&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-添加额外参数"><a href="#3-添加额外参数" class="headerlink" title="(3)添加额外参数"></a>(3)添加额外参数</h4><p>我们可以使用<strong>extra_kwargs</strong>参数为ModelSerializer添加或修改原有的选项参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = (<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;pub_date&#x27;</span>)</span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;bread&#x27;</span>: &#123;<span class="string">&#x27;min_value&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;required&#x27;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">            <span class="string">&#x27;bcomment&#x27;</span>: &#123;<span class="string">&#x27;min_value&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;required&#x27;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">BookSerializer():</span></span><br><span class="line"><span class="string">    id = IntegerField(label=&#x27;ID&#x27;, read_only=True)</span></span><br><span class="line"><span class="string">    title = CharField(label=&#x27;书籍名称&#x27;, max_length=32)</span></span><br><span class="line"><span class="string">    pub_date = DateField(label=&#x27;出版日期&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qyf__123/article/details/84992721">参考文章</a></p>
<h1 id="9-视图"><a href="#9-视图" class="headerlink" title="9. 视图"></a>9. 视图</h1><p>Django REST framwork 提供的视图的主要作用:</p>
<ul>
<li>控制序列化器的执行(检验、保存、转换数据)</li>
<li>控制数据库模型的操作</li>
</ul>
<p>REST framework 提供了众多的通用视图基类与扩展类, 以简化视图的编写.</p>
<h2 id="9-1、GenericAPIView-通用视图类"><a href="#9-1、GenericAPIView-通用视图类" class="headerlink" title="9.1、GenericAPIView[通用视图类]"></a>9.1、GenericAPIView[通用视图类]</h2><p>通用视图类主要作用就是把视图中的独特的代码抽取出来, 让视图方法中的代码更加通用, 方便把通用代码进行简写.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rest_framework.generics.GenericAPIView</span><br></pre></td></tr></table></figure>

<p>继承自 <code>APIView</code> , <strong>主要增加了操作序列化器和数据库查询的方法, 作用是为下面Mixin扩展类的执行提供方法支持. 通常在使用时, 可搭配一个或多个Mixin扩展类.</strong></p>
<p><strong>提供的关于序列化器使用的属性与方法</strong></p>
<h4 id="1-get-serializer-class-self"><a href="#1-get-serializer-class-self" class="headerlink" title="(1)get_serializer_class(self)"></a>(1)get_serializer_class(self)</h4><p>当出现一个视图类中调用多个序列化器时, 那么可以通过条件判断在get_serializer_class方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了.</p>
<p>返回序列化器类, 默认返回 <code>serializer_class</code> , 可以重写</p>
<h4 id="2-get-serializer-self-args-kwargs"><a href="#2-get-serializer-self-args-kwargs" class="headerlink" title="(2)get_serializer(self, *args, **kwargs)"></a>(2)get_serializer(self, *args, **kwargs)</h4><p>返回序列化器对象, 主要用来提供给Mixin扩展类使用, 如果我们在视图中想要获取序列化器对象, 也可以直接调用此方法.</p>
<p><strong>注意, 该方法在提供序列化器对象的时候, 会向序列化器对象的context属性补充三个数据:request、format、view, 这三个数据对象可以在定义序列化器时使用.</strong></p>
<ul>
<li><strong>request</strong> 当前视图的请求对象</li>
<li><strong>view</strong> 当前请求的类视图对象</li>
<li><strong>format</strong> 当前请求期望返回的数据格式</li>
</ul>
<h4 id="3-get-queryset-self"><a href="#3-get-queryset-self" class="headerlink" title="(3)get_queryset(self)"></a>(3)get_queryset(self)</h4><p>返回视图使用的查询集, 主要用来提供给Mixin扩展类使用, 是列表视图与详情视图获取数据的基础, 默认返回 <code>queryset</code> 属性, 可以重写, 例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_queryset</span>(<span class="params">self</span>):</span><br><span class="line">    user = self.request.user</span><br><span class="line">    <span class="keyword">return</span> user.accounts.<span class="built_in">all</span>()</span><br></pre></td></tr></table></figure>

<h4 id="4-get-object-self"><a href="#4-get-object-self" class="headerlink" title="(4)get_object(self)"></a>(4)get_object(self)</h4><p>返回详情视图所需的模型类数据对象, 主要用来提供给Mixin扩展类使用.</p>
<p>在试图中可以调用该方法获取详情信息的模型类对象.</p>
<p><strong>若详情访问的模型类对象不存在, 会返回404.</strong></p>
<p>该方法会默认使用APIView提供的check_object_permissions方法检查当前对象是否有权限被访问.</p>
<p>举例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;url(r&#x27;^books/(?P&lt;pk&gt;\d+)/$&#x27;, views.BookDetailView.as_view()),&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(<span class="title class_ inherited__">GenericAPIView</span>):</span><br><span class="line">    queryset = BookInfo.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        book = self.get_object() <span class="comment"># get_object()方法根据pk参数查找queryset中的数据对象</span></span><br><span class="line">        serializer = self.get_serializer(book)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p>其他可以设置的属性</p>
<ul>
<li><strong>pagination_class</strong> 指明分页控制类</li>
<li><strong>filter_backends</strong> 指明过滤控制后端</li>
</ul>
<p><strong>通用视图类的应用</strong></p>
<p>为了方便学习上面的GenericAPIView通用视图类, 我们新建一个子应用.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp gen</span><br></pre></td></tr></table></figure>

<p>路由:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">    path(<span class="string">&#x27;book/&#x27;</span>, views.BookView.as_view()),</span><br><span class="line">    re_path(<span class="string">&#x27;book/(? P&lt;pk&gt;\d+)&#x27;</span>, views. BookDetailView.as_view()), </span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>视图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;设计增删改查查接口&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;序列化器&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">GenericAPIView</span>):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        bs = BookSerializer(instance=self.get_queryset(), many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(<span class="title class_ inherited__">GenericAPIView</span>):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        bs = BookSerializer(instance=self.get_object())</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        serializer = BookSerializer(instance=self.get_object(), data=request.data)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        serializer.save()</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        self.get_object().delete()</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br></pre></td></tr></table></figure>

<h2 id="9-2、5个视图扩展类"><a href="#9-2、5个视图扩展类" class="headerlink" title="9.2、5个视图扩展类"></a>9.2、5个视图扩展类</h2><p>也叫混入类(Mixin).</p>
<p>作用:</p>
<p>提供了几种后端视图(对数据资源进行增删改查)处理流程的实现, 如果需要编写的视图属于这五种, 则视图可以通过继承相应的扩展类来复用代码, 减少自己编写的代码量.</p>
<p>这五个扩展类需要搭配GenericAPIView通用视图基类, 因为五个扩展类的实现需要调用GenericAPIView提供的序列化器与数据库查询的方法.</p>
<h4 id="1-ListModelMixin"><a href="#1-ListModelMixin" class="headerlink" title="(1)ListModelMixin"></a>(1)ListModelMixin</h4><p>列表视图扩展类, 提供 <code>list(request, *args, **kwargs)</code> 方法快速实现列表视图, 返回200状态码.</p>
<p>该Mixin的list方法会对数据进行过滤和分页.</p>
<p>源代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ListModelMixin</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    List a queryset.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line"></span><br><span class="line">        page = self.paginate_queryset(queryset)</span><br><span class="line">        <span class="keyword">if</span> page <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            serializer = self.get_serializer(page, many=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">return</span> self.get_paginated_response(serializer.data)</span><br><span class="line"></span><br><span class="line">        serializer = self.get_serializer(queryset, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p>基于扩展类实现BookView:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sers.models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> .sers <span class="keyword">import</span> BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(GenericAPIView, ListModelMixin):</span><br><span class="line"></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="（2）CreateModelMixin"><a href="#（2）CreateModelMixin" class="headerlink" title="（2）CreateModelMixin"></a>（2）CreateModelMixin</h4><p>创建视图扩展类，提供<code>create(request, *args, **kwargs)</code>方法快速实现创建资源的视图，成功返回201状态码。</p>
<p>如果序列化器对前端发送的数据验证失败，返回400错误。</p>
<p>源代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateModelMixin</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Create a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        self.perform_create(serializer)</span><br><span class="line">        headers = self.get_success_headers(serializer.data)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_create</span>(<span class="params">self, serializer</span>):</span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_success_headers</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&#x27;Location&#x27;</span>: <span class="built_in">str</span>(data[api_settings.URL_FIELD_NAME])&#125;</span><br><span class="line">        <span class="keyword">except</span> (TypeError, KeyError):</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>基于扩展类实现BookView:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(GenericAPIView, ListModelMixin, CreateModelMixin):</span><br><span class="line"></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.create(request)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="（3）RetrieveModelMixin"><a href="#（3）RetrieveModelMixin" class="headerlink" title="（3）RetrieveModelMixin"></a>（3）RetrieveModelMixin</h4><p>详情视图扩展类，提供<code>retrieve(request, *args, **kwargs)</code>方法，可以快速实现返回一个存在的数据对象。</p>
<p>如果存在，返回200， 否则返回404。</p>
<p>源代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RetrieveModelMixin</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Retrieve a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p>基于扩展类实现BookDetailView:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(GenericAPIView, RetrieveModelMixin):</span><br><span class="line"></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, pk)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="（4）UpdateModelMixin"><a href="#（4）UpdateModelMixin" class="headerlink" title="（4）UpdateModelMixin"></a>（4）UpdateModelMixin</h4><p>更新视图扩展类，提供<code>update(request, *args, **kwargs)</code>方法，可以快速实现更新一个存在的数据对象。</p>
<p>同时也提供<code>partial_update(request, *args, **kwargs)</code>方法，可以实现局部更新。</p>
<p>成功返回200，序列化器校验数据失败时，返回400错误。</p>
<p>源代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UpdateModelMixin</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Update a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        partial = kwargs.pop(<span class="string">&#x27;partial&#x27;</span>, <span class="literal">False</span>)</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance, data=request.data, partial=partial)</span><br><span class="line">        serializer.is_valid(raise_exception=<span class="literal">True</span>)</span><br><span class="line">        self.perform_update(serializer)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">getattr</span>(instance, <span class="string">&#x27;_prefetched_objects_cache&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">            <span class="string">&quot;&quot;&quot;If &#x27;prefetch_related&#x27; has been applied to a queryset, we need to</span></span><br><span class="line"><span class="string">            forcibly invalidate the prefetch cache on the instance.&quot;&quot;&quot;</span></span><br><span class="line">            instance._prefetched_objects_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_update</span>(<span class="params">self, serializer</span>):</span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">partial_update</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        kwargs[<span class="string">&#x27;partial&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> self.update(request, *args, **kwargs)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>基于扩展类实现BookDetailView:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(GenericAPIView, RetrieveModelMixin, UpdateModelMixin):</span><br><span class="line"></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, pk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.update(request, pk)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="（5）DestroyModelMixin"><a href="#（5）DestroyModelMixin" class="headerlink" title="（5）DestroyModelMixin"></a>（5）DestroyModelMixin</h4><p>删除视图扩展类，提供<code>destroy(request, *args, **kwargs)</code>方法，可以快速实现删除一个存在的数据对象。</p>
<p>成功返回204，不存在返回404。</p>
<p>源代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DestroyModelMixin</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Destroy a model instance.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">destroy</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        self.perform_destroy(instance)</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perform_destroy</span>(<span class="params">self, instance</span>):</span><br><span class="line">        instance.delete()</span><br></pre></td></tr></table></figure>

<p>基于扩展类实现BookDetailView:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(GenericAPIView, RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin):</span><br><span class="line"></span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, pk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.update(request, pk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, pk)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>整体代码，使用GenericAPIView结合视图扩展类，实现5个基本api接口，视图代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Create your views here.</span></span><br><span class="line"><span class="string">基于GenericAPIView结合5个视图扩展类完成基本的5个API接口</span></span><br><span class="line"><span class="string">ListModelMixin     提供了list方法，获取多条数据</span></span><br><span class="line"><span class="string">CreateModelMixin   提供了create方法，添加一条数据</span></span><br><span class="line"><span class="string">RetrieveModelMixin 提供了retrieve方法，获取一条数据</span></span><br><span class="line"><span class="string">UpdateModelMixin   提供了update方法，更新一条数据</span></span><br><span class="line"><span class="string">DestroyModelMixin   提供了destroy方法，删除一条数据</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;设计增删改查查接口&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;序列化器&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> GenericAPIView</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin, CreateModelMixin, RetrieveModelMixin, UpdateModelMixin, \</span><br><span class="line">    DestroyModelMixin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(GenericAPIView, ListModelMixin, CreateModelMixin):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.<span class="built_in">list</span>(request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="keyword">return</span> self.create(request)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(GenericAPIView, RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.retrieve(request, pk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.update(request, pk)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        <span class="keyword">return</span> self.destroy(request, pk)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>路由不变:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">    path(<span class="string">&#x27;books/&#x27;</span>, BookView.as_view()),</span><br><span class="line">    re_path(<span class="string">&#x27;books/(?P&lt;pk&gt;\d+)/&#x27;</span>, BookDetailView.as_view()),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-3、-GenericAPIView的视图子类"><a href="#9-3、-GenericAPIView的视图子类" class="headerlink" title="9.3、 GenericAPIView的视图子类"></a>9.3、 GenericAPIView的视图子类</h2><h4 id="（1）CreateAPIView"><a href="#（1）CreateAPIView" class="headerlink" title="（1）CreateAPIView"></a>（1）CreateAPIView</h4><p>提供了post方法，内部调用了create方法</p>
<p>继承自： GenericAPIView、CreateModelMixin</p>
<h4 id="（2）ListAPIView"><a href="#（2）ListAPIView" class="headerlink" title="（2）ListAPIView"></a>（2）ListAPIView</h4><p>提供了get方法，内部调用了list方法</p>
<p>继承自：GenericAPIView、ListModelMixin</p>
<h4 id="（3）RetrieveAPIView"><a href="#（3）RetrieveAPIView" class="headerlink" title="（3）RetrieveAPIView"></a>（3）RetrieveAPIView</h4><p>提供了get方法，内部调用了retrieve方法</p>
<p>继承自: GenericAPIView、RetrieveModelMixin</p>
<h4 id="（4）DestoryAPIView"><a href="#（4）DestoryAPIView" class="headerlink" title="（4）DestoryAPIView"></a>（4）DestoryAPIView</h4><p>提供了delete方法，内部调用了destory方法</p>
<p>继承自：GenericAPIView、DestoryModelMixin</p>
<h4 id="（5）UpdateAPIView"><a href="#（5）UpdateAPIView" class="headerlink" title="（5）UpdateAPIView"></a>（5）UpdateAPIView</h4><p>提供了put和patch方法，内部调用了update和partial_update方法</p>
<p>继承自：GenericAPIView、UpdateModelMixin</p>
<h4 id="（6）ListCreateAPIView"><a href="#（6）ListCreateAPIView" class="headerlink" title="（6）ListCreateAPIView"></a>（6）ListCreateAPIView</h4><p>提供了get和post方法，内部调用了list和create方法</p>
<p>继承自：GenericAPIView、ListModelMixin、CreateModelMixin</p>
<h4 id="（7）RetrieveUpdateAPIView"><a href="#（7）RetrieveUpdateAPIView" class="headerlink" title="（7）RetrieveUpdateAPIView"></a>（7）RetrieveUpdateAPIView</h4><p>提供 get、put、patch方法</p>
<p>继承自： GenericAPIView、RetrieveModelMixin、UpdateModelMixin</p>
<h4 id="（8）RetrieveDestoryAPIView"><a href="#（8）RetrieveDestoryAPIView" class="headerlink" title="（8）RetrieveDestoryAPIView"></a>（8）RetrieveDestoryAPIView</h4><p>提供 get、delete方法</p>
<p>继承自：GenericAPIView、RetrieveModelMixin、DestoryModelMixin</p>
<h4 id="（9）RetrieveUpdateDestoryAPIView"><a href="#（9）RetrieveUpdateDestoryAPIView" class="headerlink" title="（9）RetrieveUpdateDestoryAPIView"></a>（9）RetrieveUpdateDestoryAPIView</h4><p>提供 get、put、patch、delete方法</p>
<p>继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;设计增删改查查接口&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;序列化器&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Book</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> generics</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&#x27;__all__&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(generics.ListCreateAPIView):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookDetailView</span>(generics.RetrieveUpdateDestroyAPIView):</span><br><span class="line">    queryset = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = BookSerializer</span><br></pre></td></tr></table></figure>

<h2 id="9-4、视图集"><a href="#9-4、视图集" class="headerlink" title="9.4、视图集"></a>9.4、视图集</h2><h3 id="9-4-1、ViewSet"><a href="#9-4-1、ViewSet" class="headerlink" title="9.4.1、ViewSet"></a>9.4.1、ViewSet</h3><p>继承自 <code>APIView</code> 与 <code>ViewSetMixin</code> , 作用也与APIView基本类似, 提供了身份认证、权限校验、流量管理等.</p>
<p>**ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典{“http请求”:”视图方法”}的映射处理工作, 如{‘get’:’list’}, **</p>
<p>在ViewSet中, 没有提供任何动作action方法, 需要我们自己实现action方法.</p>
<p>使用视图集ViewSet, 可以将一系列视图相关的代码逻辑和相关的http请求动作封装到一个类中:</p>
<ul>
<li>list() 提供一组数据</li>
<li>retrieve() 提供单个数据</li>
<li>create() 创建数据</li>
<li>update() 保存数据</li>
<li>destory() 删除数据</li>
</ul>
<p>ViewSet视图集类不再限制视图方法名只允许get()、post()等这种情况了, 而是实现允许开发者根据自己的需要定义自定义方法名, 例如  list() 、create() 等, 然后经过路由中使用http和这些视图方法名进行绑定调用.</p>
<p>为了方便演示视图集的使用, 我们新建一个子应用, </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp vset</span><br></pre></td></tr></table></figure>

<p>视图集只在使用as_view()方法的时候, 才会将<strong>action</strong>动作与具体请求方式对应上. 如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> vset.views <span class="keyword">import</span> BookView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;path(&quot;set&quot;, views.BookView.as_view(&#123;&quot;http请求&quot;:&quot;视图方法&quot;&#125;)),&#x27;&#x27;&#x27;</span></span><br><span class="line">    path(<span class="string">&quot;books/&quot;</span>, BookView.as_view(&#123;</span><br><span class="line">        <span class="string">&quot;get&quot;</span>: <span class="string">&quot;get_all_book&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post&quot;</span>: <span class="string">&quot;add_book&quot;</span></span><br><span class="line">    &#125;)),</span><br><span class="line">    re_path(<span class="string">&quot;^books/(?P&lt;pk&gt;\d+)$&quot;</span>, BookView.as_view(&#123;</span><br><span class="line">        <span class="string">&quot;get&quot;</span>: <span class="string">&quot;get_one_book&quot;</span>,</span><br><span class="line">        <span class="string">&quot;put&quot;</span>: <span class="string">&quot;edit_book&quot;</span>,</span><br><span class="line">        <span class="string">&quot;delete&quot;</span>: <span class="string">&quot;delete&quot;</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ViewSet</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sers.models <span class="keyword">import</span> Book</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Book</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">ViewSet</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_all_book</span>(<span class="params">self, request</span>):</span><br><span class="line"></span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        bs = BookSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_book</span>(<span class="params">self, request</span>):</span><br><span class="line">        bs = BookSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_one_book</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        book = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=book)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">edit_book</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        instance = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=instance, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        Book.objects.get(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="9-4-2、GenericViewSet"><a href="#9-4-2、GenericViewSet" class="headerlink" title="9.4.2、GenericViewSet"></a>9.4.2、GenericViewSet</h3><p>继承自GenericAPIView和ViewSetMixin, 作用让视图集的视图代码变得更加通用, 抽离独特代码作为视图类的属性.</p>
<p>使用ViewSet通常并不方便, 因为list、retrieve、create、update、destory等方法都需要自己编写, 而这些方法与前面讲过的Mixin扩展类提供的方法同名, 所以我们可以通过继承Mixin扩展类来复用这些方法而无需自己编写. 但是Mixin扩展类依赖与 <code>GenericAPIView</code> , 所以还需要继承 <code>GenericAPIView</code> .</p>
<p><strong>GenericViewSet</strong>就帮助我们完成了这样的继承工作, 继承自 <code>GenericAPIView</code> 与 <code>ViewSetMixin</code> , 在实现了调用as_view()时传入字典(如 <code>&#123;&#39;get&#39;:&#39;list&#39;&#125;</code> )的映射处理工作的同时, 还提供了 <code>GenericAPIView</code> 提供的基础方法, 可以直接搭配Mixin扩展类使用.</p>
<p>视图代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> GenericViewSet</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">GenericViewSet</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">list</span>(<span class="params">self, request</span>):</span><br><span class="line"></span><br><span class="line">        books = Book.objects.<span class="built_in">all</span>()</span><br><span class="line">        bs = BookSerializer(instance=books, many=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create</span>(<span class="params">self, request</span>):</span><br><span class="line">        bs = BookSerializer(data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">retrieve</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        book = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=book)</span><br><span class="line">        <span class="keyword">return</span> Response(bs.data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        instance = Book.objects.get(pk=pk)</span><br><span class="line">        bs = BookSerializer(instance=instance, data=request.data)</span><br><span class="line">        <span class="keyword">if</span> bs.is_valid():</span><br><span class="line">            bs.save()</span><br><span class="line">            <span class="keyword">return</span> Response(bs.data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(bs.errors)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self, request, pk</span>):</span><br><span class="line">        Book.objects.get(pk=pk).delete()</span><br><span class="line">        <span class="keyword">return</span> Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> vset.views <span class="keyword">import</span> BookView</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;path(&quot;set&quot;, views.BookView.as_view(&#123;&quot;http请求&quot;:&quot;视图方法&quot;&#125;)),&#x27;&#x27;&#x27;</span></span><br><span class="line">    path(<span class="string">&quot;books/&quot;</span>, BookView.as_view(&#123;</span><br><span class="line">        <span class="string">&quot;get&quot;</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post&quot;</span>: <span class="string">&quot;create&quot;</span></span><br><span class="line">    &#125;)),</span><br><span class="line">    re_path(<span class="string">&quot;^books/(?P&lt;pk&gt;\d+)$&quot;</span>, BookView.as_view(&#123;</span><br><span class="line">        <span class="string">&quot;get&quot;</span>: <span class="string">&quot;retrieve&quot;</span>,</span><br><span class="line">        <span class="string">&quot;put&quot;</span>: <span class="string">&quot;update&quot;</span>,</span><br><span class="line">        <span class="string">&quot;delete&quot;</span>: <span class="string">&quot;delete&quot;</span>,</span><br><span class="line">    &#125;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>集合我们上面学习的模型扩展类, 实现简写操作, 视图, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> GenericViewSet</span><br><span class="line"><span class="keyword">from</span> rest_framework.mixins <span class="keyword">import</span> ListModelMixin, CreateModelMixin, RetrieveModelMixin, UpdateModelMixin, \</span><br><span class="line"></span><br><span class="line">    DestroyModelMixin</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(GenericViewSet, ListModelMixin, CreateModelMixin, RetrieveModelMixin, UpdateModelMixin, </span><br><span class="line"></span><br><span class="line">                          DestroyModelMixin):</span><br><span class="line">    queryset = Book.objects</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="9-4-3、ModelViewSet和ReadOnlyModelViewSet"><a href="#9-4-3、ModelViewSet和ReadOnlyModelViewSet" class="headerlink" title="9.4.3、ModelViewSet和ReadOnlyModelViewSet"></a>9.4.3、ModelViewSet和ReadOnlyModelViewSet</h3><p>ModelViewSet继承自<code>GenericViewSet</code>，同时包括了ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin。</p>
<p>ReadOnlyModelViewSet承自<code>GenericViewSet</code>，同时包括了ListModelMixin、RetrieveModelMixin。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Book.objects</span><br><span class="line">    serializer_class = BookSerializer</span><br></pre></td></tr></table></figure>

<h1 id="10-路由Routers"><a href="#10-路由Routers" class="headerlink" title="10. 路由Routers"></a>10. 路由Routers</h1><p>对于视图集ViewSet, 我们除了可以自己手动指明请求方式与动作action之间的对应关系外, 还可以使用Routers来帮助我们快速实现路由信息.</p>
<p>REST framework提供了两个router</p>
<ul>
<li><strong>SimpleRouter</strong></li>
<li><strong>DefaultRouter</strong></li>
</ul>
<h2 id="10-1-使用方法"><a href="#10-1-使用方法" class="headerlink" title="10.1 使用方法"></a>10.1 使用方法</h2><ol>
<li>创建router对象, 并注册视图集, 例如</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line">router = routers.DefaultRouter()</span><br><span class="line">router.register(<span class="string">&#x27;book&#x27;</span>, BookView, base_name=<span class="string">&#x27;book&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>register(prefix, viewset, base_name)</p>
<blockquote>
<ul>
<li>prefix 该视图集的路由前缀</li>
<li>viewset 视图集</li>
<li>base_name 路由别名的前缀</li>
</ul>
</blockquote>
<p>如上述代码会形成的路由如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">^book/$    name: book-<span class="built_in">list</span></span><br><span class="line">^book/&#123;pk&#125;/$   name: book-detail</span><br></pre></td></tr></table></figure>

<p>2)添加路由数据</p>
<p>可以有两种方式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line">urlpatterns += router.urls</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    path(<span class="string">&#x27;^&#x27;</span>, include(router.urls))</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>路由代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;使用drf提供路由类router给视图集生成路由列表&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;实例化路由类</span></span><br><span class="line"><span class="string">drf提供一共提供了两个路由类给我们使用,他们用法一致,功能几乎一样&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> DefaultRouter</span><br><span class="line">router = DefaultRouter()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;注册视图集&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;router.register(&quot;路由前缀&quot;,视图集类)&#x27;&#x27;&#x27;</span></span><br><span class="line">router.register(<span class="string">&quot;book&quot;</span>,views.BookView)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;把生成的路由列表追加到urlpatterns&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>( router.urls )</span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure>

<p>上面的代码就成功生成了路由地址[增&#x2F;删&#x2F;改&#x2F;查一条&#x2F;查多条的功能], 但是不会自动我们在视图集自定义方法的路由.</p>
<p>所以我们如果也要给自定义方法生成路由, 则需要进行action动作的声明.</p>
<h2 id="10-2-视图集中附加action的声明"><a href="#10-2-视图集中附加action的声明" class="headerlink" title="10.2 视图集中附加action的声明"></a>10.2 视图集中附加action的声明</h2><p>在视图集中, 如果想要让Router自动帮助我们为自定义的动作生成路由信息, 需要使用 <code>rest_framework.decorators.action</code> 装饰器.</p>
<p>以action装饰器装饰的方法名会作为action动作名, 与list、retrieve等同.</p>
<p>action装饰器可以接收两个参数:</p>
<ul>
<li><p><strong>methods</strong>: 声明该action对应的请求方式, 列表传递</p>
</li>
<li><p><strong>detail</strong>: 声明该action的路径是否与单一资源对应</p>
</li>
<li><p><strong>detail</strong>: 声明该action的路径是否与单一资源对应</p>
</li>
<li><p><strong>detail</strong>: 声明该action的路径是否与单一资源对应</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">路由前缀/&lt;pk&gt;/action方法名/</span><br></pre></td></tr></table></figure>

<ul>
<li>True 表示路径格式是<code>xxx/&lt;pk&gt;/action方法名/</code></li>
<li>False 表示路径格式是<code>xxx/action方法名/</code></li>
</ul>
<ul>
<li>url_path: 声明该action的路由尾缀.</li>
</ul>
<p>举例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> rest_framework.decorators <span class="keyword">import</span> action</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BookView</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Book.objects</span><br><span class="line">    serializer_class = BookSerializer</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    action装饰器的作用：告诉路由类给视图集的自定义方法生成路由信息</span></span><br><span class="line"><span class="string">    methods, 列表，允许哪些http请求能访问当前视图方法</span></span><br><span class="line"><span class="string">    detail，布尔，生成路由时是否拼接pk参数</span></span><br><span class="line"><span class="string">            detail为True，表示路径名格式应该为 book/&#123;pk&#125;/login/</span></span><br><span class="line"><span class="string">    url_path，字符串，生成路由时末尾路由路径，如果没有声明，则自动以当前方法名作为路由尾缀</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">True</span>,url_path=<span class="string">&quot;login&quot;</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, request,pk</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;登录&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> Response(&#123;<span class="string">&quot;msg&quot;</span>:request.method&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;detail为False 表示路径名格式应该为 book/get_new_5/&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @action(<span class="params">methods=[<span class="string">&#x27;get&#x27;</span>], detail=<span class="literal">False</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_new_5</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取最新添加的5本书&quot;&quot;&quot;</span></span><br><span class="line">        ...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>由路由器自动为此视图集自定义action方法形成的路由会是如下内容:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">^book/get_new_5/$    name: book-get_new_5</span><br><span class="line">^book/&#123;pk&#125;/login/$   name: book-login</span><br></pre></td></tr></table></figure>

<h2 id="10-3-路由router形成URL的方式"><a href="#10-3-路由router形成URL的方式" class="headerlink" title="10.3 路由router形成URL的方式"></a>10.3 路由router形成URL的方式</h2><ol>
<li>SimpleRouter(prefix&#x3D;”路由前缀”, viewset&#x3D;视图集类, basename&#x3D;”路由别名”)</li>
</ol>
<img src="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/SimpleRouter-16318481562175.png" class="" title="SimpleRouter">

<p>2)DefaultRouter</p>
<img src="/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/DefaultRouter-16318481562186.png" class="" title="DefaultRouter">

<p>DefaultRouter与SimpleRouter的区别是, DefaultRouter会多附带一个默认的API根视图, 返回一个包含所有列表视图的超链接响应数据.</p>
<h1 id="11、其它功能组件"><a href="#11、其它功能组件" class="headerlink" title="11、其它功能组件"></a>11、其它功能组件</h1><p>为了方便接下来的学习, 我们创建一个新的子应用 opt</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp opt</span><br></pre></td></tr></table></figure>

<p>注册子应用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;opt&#x27;</span>,     <span class="comment"># drf提供的组件使用</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>总路由, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;students/&#x27;</span>, include(<span class="string">&quot;students.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&#x27;sers/&#x27;</span>, include(<span class="string">&quot;sers.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&#x27;school/&#x27;</span>, include(<span class="string">&quot;school.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&quot;req/&quot;</span>, include(<span class="string">&quot;req.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&quot;demo/&quot;</span>, include(<span class="string">&quot;demo.urls&quot;</span>)),</span><br><span class="line">    path(<span class="string">&quot;opt/&quot;</span>, include(<span class="string">&quot;opt.urls&quot;</span>)),</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>子路由, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line">urlpatterns = [</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>因为接下来的认证组件中需要使用到登陆功能, 所以我们使用django内置admin站点并创建一个管理员.</p>
<p>admin运营站点的访问地址:<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/admin">http://127.0.0.1:8000/admin</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br><span class="line">&#x27;&#x27;&#x27;如果之前有账号，但是忘了，可以通过终端下的命令修改指定用户的密码，这里的密码必须8位长度以上的&#x27;&#x27;&#x27;</span><br><span class="line">python manage.py changepassword 用户名</span><br></pre></td></tr></table></figure>

<p>创建管理员以后, 访问admin站点, 先修改站点的语言配置</p>
<p>settings.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LANGUAGE_CODE = &#x27;zh-hans&#x27;</span><br><span class="line"></span><br><span class="line">TIME_ZONE = &#x27;Asia/Shanghai&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="11-1-认证Authentication"><a href="#11-1-认证Authentication" class="headerlink" title="11.1. 认证Authentication"></a>11.1. 认证Authentication</h2><p>可以在配置文件中配置全局默认的认证方案</p>
<p>常见的认证方式:cookie、session、token</p>
<p>&#x2F;home&#x2F;moluo&#x2F;.virtualenvs&#x2F;drfdemo&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;rest_framework&#x2F;settings.py 默认配置文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>, <span class="comment"># session认证</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,   <span class="comment"># 基本认证</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以在具体的视图类中通过设置authentication_classess类属性来设置单独的不同的认证方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication, BasicAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    authentication_classes = [SessionAuthentication, BasicAuthentication]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>认证失败会有两种可能的返回值, 这个需要我们配合权限组件来使用:</p>
<ul>
<li>401 Unauthorized 未认证</li>
<li>403 Permission Denied 权限被禁止</li>
</ul>
<p>自定义认证, <code>drfdemo.authentication</code> 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> BaseAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.exceptions <span class="keyword">import</span> APIException</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomAuthentication</span>(<span class="title class_ inherited__">BaseAuthentication</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    自定义认证方式</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authenticate</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;:::&quot;</span>)</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        认证方法</span></span><br><span class="line"><span class="string">        request: 本次客户端发送过来的http请求对象</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;token = request.query_params.get(&quot;token&quot;)&#x27;&#x27;&#x27;</span></span><br><span class="line">        token = request._request.META.get(<span class="string">&quot;HTTP_TOKEN&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> token != <span class="string">&quot;123456789&quot;</span>:</span><br><span class="line">            <span class="keyword">raise</span> APIException(<span class="string">&quot;认证失败&quot;</span>)</span><br><span class="line">        user = <span class="string">&quot;root&quot;</span></span><br><span class="line">        <span class="keyword">return</span> (user,token)  <span class="comment"># 按照固定的返回格式填写 （用户模型对象, None）</span></span><br></pre></td></tr></table></figure>

<p>视图调用自定义认证, 视图代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AnonymousUser</span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication</span><br><span class="line"><span class="keyword">from</span> drfdemo.authentication <span class="keyword">import</span> CustomAuthentication</span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HomeAPIView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;authentication_classes = [CustomAuthentication, ]&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;单独设置认证方式&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(request.user) <span class="comment"># 在中间件AuthenticationMiddleware中完成用户身份识别的，如果没有登录request.user值为AnonymousUser</span></span><br><span class="line">        <span class="keyword">if</span> request.user.<span class="built_in">id</span> <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">&quot;未登录用户：游客&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">f&quot;已登录用户：<span class="subst">&#123;request.user&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>当然, 也可以注释掉上面视图中的配置, 改成全局配置.settings.py, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;drf配置信息必须全部写在REST_FRAMEWORK配置项中&quot;&quot;&quot;</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;配置认证方式的选项【drf的认证是内部循环遍历每一个注册的认证类，一旦认证通过识别到用户身份，则不会继续循环】&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>: (</span><br><span class="line">        <span class="string">&#x27;drfdemo.authentication.CustomAuthentication&#x27;</span>,          <span class="comment"># 自定义认证</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,  <span class="comment"># session认证</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,    <span class="comment"># 基本认证</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="11-2-权限Permissions"><a href="#11-2-权限Permissions" class="headerlink" title="11.2. 权限Permissions"></a>11.2. 权限Permissions</h2><p>权限控制可以限制用户对于视图的访问和对于具有模型对象的访问.</p>
<ul>
<li>在执行视图的as_view()方法的dispatch()方法前, 会先进行视图访问权限的判断</li>
<li>在通过get_object()获取具体模型对象时, 会进行模型对象访问权限的判断</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>可以在配置文件中<strong>全局设置</strong>默认的权限管理类, 如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    ....</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">        <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果未指明, 则采用如下默认配置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: (</span><br><span class="line">   <span class="string">&#x27;rest_framework.permissions.AllowAny&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>也可以在具体的视图中通过permission_classes属性来进行局部设置, 如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleView</span>(<span class="title class_ inherited__">APIView</span>):</span><br><span class="line">    permission_classes = (IsAuthenticated,)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h3 id="提供的权限"><a href="#提供的权限" class="headerlink" title="提供的权限"></a>提供的权限</h3><ul>
<li>AllowAny 允许所有用户, 默认权限</li>
<li>IsAuthenticated 仅通过登录认证的用户</li>
<li>IsAdminUser 仅管理员用户</li>
<li>IsAuthenticatedOrReadOnly 已经登陆认证的用户可以对数据进行增删改操作, 没有登陆认证的只能查看数据.</li>
</ul>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated</span><br><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> RetrieveAPIView</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VulnAPIView</span>(<span class="title class_ inherited__">RetrieveAPIView</span>):</span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = VulnSerializer</span><br><span class="line">    authentication_classes = [SessionAuthentication]</span><br><span class="line">    permission_classes = [IsAuthenticated]</span><br></pre></td></tr></table></figure>

<h3 id="自定义权限"><a href="#自定义权限" class="headerlink" title="自定义权限"></a>自定义权限</h3><p>如需自定义权限, 需继承rest_framework.permissions. BasePermission父类, 并实现以下两个任何一个方法或全部</p>
<ul>
<li><p><code>.has_permission(self, request, view)</code></p>
<p>是否可以访问视图, view表示当前视图对象</p>
</li>
<li><p><code>.has_object_permission(self, request, view, obj)</code></p>
<p>是否可以访问模型对象, view表示当前视图, obj为模型数据对象</p>
</li>
</ul>
<p>例如:</p>
<p>在当前子应用下, 创建一个权限文件drfdemo.permissions.py中声明自定义权限类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IsXiaoMingPermission</span>(<span class="title class_ inherited__">BasePermission</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    自定义权限，可用于全局配置，也可以用于局部</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_permission</span>(<span class="params">self, request, view</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        视图权限</span></span><br><span class="line"><span class="string">        返回结果未True则表示允许访问视图类</span></span><br><span class="line"><span class="string">        request: 本次客户端提交的请求对象</span></span><br><span class="line"><span class="string">        view: 本次客户端访问的视图类</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        role = request.query_params.get(<span class="string">&quot;role&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> role == <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_object_permission</span>(<span class="params">self, request, view, obj</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        模型权限</span></span><br><span class="line"><span class="string">        返回结果为True则表示允许操作模型对象</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>视图代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .permissions <span class="keyword">import</span> IsXiaoMingPermission</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StudentViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentSerializer</span><br><span class="line">    permission_classes = [IsXiaoMingPermission] <span class="comment"># 自定义权限</span></span><br></pre></td></tr></table></figure>

<p>认证和权限的举例代码:</p>
<p>settings.py, 全局配置, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;关于REST_FRAMEWORK的所有配置项都是填写在django的settings配置文件中的。</span></span><br><span class="line"><span class="string">所有的REST_FRAMEWORK都要填写在 REST_FRAMEWORK的配置项，而且配置只能大写！！&#x27;&#x27;&#x27;</span></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;认证全局配置&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;</span>:[</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;默认由drf提供的认证方式&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.SessionAuthentication&#x27;</span>,  <span class="comment"># session认证</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.authentication.BasicAuthentication&#x27;</span>,   <span class="comment"># 基本认证</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;将来开发中，我们还可以自己实现属于自己项目的认证方式&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="string">&#x27;drfdemo.authentications.CustomAuthentication&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;权限全局配置&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;</span>: [</span><br><span class="line">        <span class="string">&quot;&quot;&quot;设置所有视图只能被已经登录认证过的用户访问&quot;&quot;&quot;</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.permissions.IsAuthenticated&#x27;</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视图代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.viewsets <span class="keyword">import</span> ModelViewSet</span><br><span class="line"><span class="keyword">from</span> student.models <span class="keyword">import</span> Student</span><br><span class="line"><span class="keyword">from</span> student.serializers <span class="keyword">import</span> StudentModelSerializer</span><br><span class="line"><span class="keyword">from</span> drfdemo.authentications <span class="keyword">import</span> CustomAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication</span><br><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> IsAuthenticated,IsAdminUser,IsAuthenticatedOrReadOnly</span><br><span class="line"><span class="keyword">from</span> drfdemo.permissions <span class="keyword">import</span> IsXiaoMingPermission</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student1ModelViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Student.objects</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line"><span class="string">&quot;&quot;&quot;    # 局部认证配置方式&quot;&quot;&quot;</span></span><br><span class="line">    authentication_classes = [SessionAuthentication,CustomAuthentication]</span><br><span class="line"><span class="string">&quot;&quot;&quot;    # 局部权限配置方式</span></span><br><span class="line"><span class="string">    # permission_classes = [IsAuthenticated] # 只要经过认证登录就可以访问</span></span><br><span class="line"><span class="string">    # permission_classes = [IsAdminUser] # 只要是站点管理员就可以访问</span></span><br><span class="line"><span class="string">    # permission_classes = [IsAuthenticatedOrReadOnly] # 登录用户可以访问视图的增删查改页面，未登录的游客只能查看数据。不能修改！</span></span><br><span class="line"><span class="string">    # permission_classes = [] # 取消权限判断识别&quot;&quot;&quot;</span></span><br><span class="line">    permission_classes = [IsXiaoMingPermission] <span class="comment"># 自定义权限</span></span><br></pre></td></tr></table></figure>

<p>自定义认证类, <code>drfdemo.authentications</code> , 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.authentication <span class="keyword">import</span> SessionAuthentication,BaseAuthentication</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomAuthentication</span>(<span class="title class_ inherited__">BaseAuthentication</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    自定义认证</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">authenticate</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        认证方法</span></span><br><span class="line"><span class="string">        request: 本次客户端发送过来的http请求对象</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        role = request.query_params.get(<span class="string">&quot;role&quot;</span>)</span><br><span class="line">        root = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> role == <span class="string">&quot;root&quot;</span>:</span><br><span class="line">            root = User.objects.get(pk=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> (root,<span class="literal">None</span>) <span class="comment"># 按照固定的返回格式填写 （用户模型对象, None）</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>自定义权限类, <code>defdemo.permissions</code> , 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.permissions <span class="keyword">import</span> BasePermission</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IsXiaoMingPermission</span>(<span class="title class_ inherited__">BasePermission</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    自定义权限，可用于全局配置，也可以用于局部</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_permission</span>(<span class="params">self, request, view</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        视图权限</span></span><br><span class="line"><span class="string">        返回结果未True则表示允许访问视图类</span></span><br><span class="line"><span class="string">        request: 本次客户端提交的请求对象</span></span><br><span class="line"><span class="string">        view: 本次客户端访问的视图类</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        role = request.query_params.get(<span class="string">&quot;role&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> role == <span class="string">&quot;xiaoming&quot;</span> <span class="comment"># 认证的结果必须返回True或者False，表示是否有权限</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">has_object_permission</span>(<span class="params">self, request, view, obj</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        模型权限</span></span><br><span class="line"><span class="string">        返回结果未True则表示允许操作模型对象</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>urls, 路由代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path,include</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> rest_framework.routers <span class="keyword">import</span> SimpleRouter</span><br><span class="line">router = SimpleRouter()</span><br><span class="line">router.register(<span class="string">&quot;stu1&quot;</span>, views.Student1ModelViewSet,)</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&quot;&quot;</span>, include(router.urls)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="11-3-限流Throttling"><a href="#11-3-限流Throttling" class="headerlink" title="11.3. 限流Throttling"></a>11.3. 限流Throttling</h2><p>可以对接口访问的频次进行限制, 以减轻服务器压力, 或者实现特定的业务.</p>
<p>一般用于付费购买次数, 投票等场景使用.</p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>可以在配置文件中, 使用 <code>DEFAULT_THROTTLE_CLASSES</code> 和 <code>DEFAULT_THROTTLE_RATES</code> 进行全局配置, </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line"><span class="string">&quot;&quot;&quot;    # 限流全局配置</span></span><br><span class="line"><span class="string">    # &#x27;DEFAULT_THROTTLE_CLASSES&#x27;:[ # 限流配置类</span></span><br><span class="line"><span class="string">    #     &#x27;rest_framework.throttling.AnonRateThrottle&#x27;, # 未认证用户[未登录用户]</span></span><br><span class="line"><span class="string">    #     &#x27;rest_framework.throttling.UserRateThrottle&#x27;, # 已认证用户[已登录用户]</span></span><br><span class="line"><span class="string">    # ],&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>:&#123; <span class="comment"># 频率配置</span></span><br><span class="line">        <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;2/day&#x27;</span>,  <span class="comment"># 针对游客的访问频率进行限制，实际上，drf只是识别首字母，但是为了提高代码的维护性，建议写完整单词</span></span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;5/day&#x27;</span>, <span class="comment"># 针对会员的访问频率进行限制，</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DEFAULT_THROTTLE_RATES</code> 可以使用 <code>second</code> , <code>minute</code> , <code>hour</code> 或 <code>day</code> 来指明周期.</p>
<p>也可以在具体视图中通过throttle_classess属性来配置, 如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> UserRateThrottle</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student2ModelViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Student.objects</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 限流局部配置[这里需要配合在全局配置中的DEFAULT_THROTTLE_RATES来设置频率]&quot;&quot;&quot;</span></span><br><span class="line">    throttle_classes = [UserRateThrottle]</span><br></pre></td></tr></table></figure>

<h3 id="可选限流类"><a href="#可选限流类" class="headerlink" title="可选限流类"></a>可选限流类</h3><ol>
<li>AnonRateThrottle</li>
</ol>
<p>限制所有匿名未认证用户, 使用IP区分用户.【很多公司这样的, IP结合设备信息来判断, 当然比IP要靠谱一点点而已】</p>
<p>使用 <code>DEFAULT_THROTTLE_RATES[&#39;anon&#39;]</code> 来设置频次</p>
<p>2)UserRateThrottle</p>
<p>限制认证用户, 使用User模型的 id主键 来区分.</p>
<p>使用 <code>DEFAULT_THROTTLE_RATES[&#39;user&#39;]</code> 来设置频次</p>
<p>3)ScopedRateThrottle</p>
<p>限制用户对于每个视图的访问频次, 使用ip或user id.</p>
<p>settings.py, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 限流全局配置&quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_CLASSES&#x27;</span>:[ <span class="comment"># 限流配置类</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;#     &#x27;rest_framework.throttling.AnonRateThrottle&#x27;, # 未认证用户[未登录用户]</span></span><br><span class="line"><span class="string">    #     &#x27;rest_framework.throttling.UserRateThrottle&#x27;, # 已认证用户[已登录用户]&quot;&quot;&quot;</span></span><br><span class="line">        <span class="string">&#x27;rest_framework.throttling.ScopedRateThrottle&#x27;</span>, <span class="comment"># 自定义限流</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;DEFAULT_THROTTLE_RATES&#x27;</span>:&#123; <span class="comment"># 频率配置</span></span><br><span class="line">        <span class="string">&#x27;anon&#x27;</span>: <span class="string">&#x27;2/day&#x27;</span>,  <span class="comment"># 针对游客的访问频率进行限制，实际上，drf只是识别首字母，但是为了提高代码的维护性，建议写完整单词</span></span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;5/day&#x27;</span>, <span class="comment"># 针对会员的访问频率进行限制，</span></span><br><span class="line">        <span class="string">&#x27;vip&#x27;</span>: <span class="string">&#x27;10/day&#x27;</span>, <span class="comment"># 针对会员的访问频率进行限制，</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视图代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.throttling <span class="keyword">import</span> UserRateThrottle</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student2ModelViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Student.objects</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 限流局部配置[这里需要配合在全局配置中的DEFAULT_THROTTLE_RATES来设置频率]</span></span><br><span class="line"><span class="string">    # throttle_classes = [UserRateThrottle] # 使用drf限流类来配置频率&quot;&quot;&quot;</span></span><br><span class="line">    throttle_scope = <span class="string">&quot;vip&quot;</span> <span class="comment"># 自定义频率</span></span><br></pre></td></tr></table></figure>

<h2 id="11-4-过滤Filtering"><a href="#11-4-过滤Filtering" class="headerlink" title="11.4. 过滤Filtering"></a>11.4. 过滤Filtering</h2><p>对于列表数据可能需要根据字段进行过滤, 我们可以通过添加django-fitlter扩展来增强支持.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-filter</span><br></pre></td></tr></table></figure>

<p>在配置文件中增加过滤后端的设置:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;django_filters&#x27;</span>,  <span class="comment"># 需要注册应用，</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">&#x27;DEFAULT_FILTER_BACKENDS&#x27;</span>: (<span class="string">&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;</span>,)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在视图类中添加类属性filter_fields, 指定可以过滤的字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StudentListView</span>(<span class="title class_ inherited__">ListAPIView</span>):</span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentSerializer</span><br><span class="line">    filter_fields = [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="11-5-排序Ordering"><a href="#11-5-排序Ordering" class="headerlink" title="11.5. 排序Ordering"></a>11.5. 排序Ordering</h2><p>对于列表数据, REST framework提供了<strong>OrderingFilter</strong>过滤器来帮助我们快速指明数据按照指定字段进行排序.</p>
<p>使用方法:</p>
<p>在类视图中设置filter_backends, 使用 <code>rest_framework.filters.OrderingFilter</code> 过滤器, REST framework会在请求的查询字符串参数中检查是否包含了ordering参数, 如果包含了ordering参数, 则按照ordering参数指明的排序字段对数据集进行排序.</p>
<p>前端可以传递的ordering参数的可选字段值需要在ordering_fields中指明.</p>
<p>示例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StudentListView</span>(<span class="title class_ inherited__">ListAPIView</span>):</span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line">    filter_backends = [OrderingFilter]</span><br><span class="line">    ordering_fields = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;# 127.0.0.1:8000/books/?ordering=-age</span></span><br><span class="line"><span class="string"># -id 表示针对id字段进行倒序排序</span></span><br><span class="line"><span class="string"># id  表示针对id字段进行升序排序&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果需要在过滤以后再次进行排序, 则需要两者结合!</p>
<p>全局配置下的过滤组件不能和排序组件一起使用, 只支持局部配置的过滤组件和排序组件一起使用.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.generics <span class="keyword">import</span> ListAPIView</span><br><span class="line"><span class="keyword">from</span> students.models <span class="keyword">import</span> Student</span><br><span class="line"><span class="keyword">from</span> .serializers <span class="keyword">import</span> StudentModelSerializer</span><br><span class="line"><span class="keyword">from</span> django_filters.rest_framework <span class="keyword">import</span> DjangoFilterBackend</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student3ListView</span>(<span class="title class_ inherited__">ListAPIView</span>):</span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line">    filter_fields = [<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>]</span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 因为局部配置会覆盖全局配置,所以需要重新把过滤组件核心类再次声明,</span></span><br><span class="line"><span class="string">    # 否则过滤功能会失效&quot;&quot;&quot;</span></span><br><span class="line">    filter_backends = [OrderingFilter,DjangoFilterBackend]</span><br><span class="line">    ordering_fields = [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="11-6-分页Pagination"><a href="#11-6-分页Pagination" class="headerlink" title="11.6. 分页Pagination"></a>11.6. 分页Pagination</h2><p>因为django默认提供的分页器主要使用于前后端不分离的业务场景, 所以REST framework也提供了分页的支持.</p>
<p>我们可以在配置文件中设置全局的分页方式, 如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;DEFAULT_PAGINATION_CLASS&#x27;</span>:  <span class="string">&#x27;rest_framework.pagination.PageNumberPagination&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;PAGE_SIZE&#x27;</span>: <span class="number">100</span>  <span class="comment"># 每页数目</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;# 如果在配置settings.py文件中， 设置了全局分页，那么在drf中凡是调用了ListModelMixin的list()，都会自动分页。如果项目中出现大量需要分页的数据，只有少数部分的分页，则可以在少部分的视图类中关闭分页功能。</span></span><br><span class="line"><span class="string"># 另外，视图类在使用过分页以后，务必在编写queryset属性时，模型.objects后面调用结果。例如：</span></span><br><span class="line"><span class="string"># Student.objects.all()&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student3ModelViewSet</span>(<span class="title class_ inherited__">ListAPIView</span>):</span><br><span class="line">	pagination_class = <span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>也可通过自定义Pagination类, 来为视图添加不同分页行为. 在视图中通过 <code>pagination_clas</code> 属性来指明.</p>
<p>可选分页器:</p>
<ol>
<li><strong>PageNumberPagination</strong></li>
</ol>
<p>前端访问网址形式:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET  http://127.0.0.1:8000/students/?page=4</span><br></pre></td></tr></table></figure>

<p>可以在子类中定义的属性:</p>
<ul>
<li>page_size 每页数目</li>
<li>page_query_param 前端发送的页数关键字名, 默认为”page”</li>
<li>page_size_query_param 前端发送的每页数目关键字名, 默认为None</li>
<li>max_page_size 前端最多能设置的每页数量</li>
</ul>
<p>分页器类, <code>paginations</code> , 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span>  rest_framework.pagination <span class="keyword">import</span> PageNumberPagination,LimitOffsetPagination</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StudentPageNumberPagination</span>(<span class="title class_ inherited__">PageNumberPagination</span>):</span><br><span class="line">    page_query_param = <span class="string">&quot;page&quot;</span> <span class="comment"># 查询字符串中代表页码的变量名</span></span><br><span class="line">    page_size_query_param = <span class="string">&quot;size&quot;</span> <span class="comment"># 查询字符串中代表每一页数据的变量名</span></span><br><span class="line">    page_size = <span class="number">2</span> <span class="comment"># 每一页的数据量</span></span><br><span class="line">    max_page_size = <span class="number">4</span> <span class="comment"># 允许客户端通过查询字符串调整的最大单页数据量</span></span><br></pre></td></tr></table></figure>

<p>视图, <code>views</code> , 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .paginations <span class="keyword">import</span> StudentPageNumberPagination,StudentLimitOffsetPagination</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student3ModelViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 取消当前视图类的分页效果</span></span><br><span class="line"><span class="string">    # pagination_class = None</span></span><br><span class="line"><span class="string">    # 局部分页&quot;&quot;&quot;</span></span><br><span class="line">    pagination_class = StudentPageNumberPagination</span><br></pre></td></tr></table></figure>

<p>2)<strong>LimitOffsetPagination</strong></p>
<p>前端访问网址形式:</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://127.0.0.1/four/students/?limit=100&amp;offset=100</span><br></pre></td></tr></table></figure>

<p>可以在子类中定义的属性:</p>
<ul>
<li>default_limit 默认限制, 默认值与<code>PAGE_SIZE</code>设置一直</li>
<li>limit_query_param limit参数名, 默认’limit’</li>
<li>offset_query_param offset参数名, 默认’offset’</li>
<li>max_limit 最大limit限制, 默认None</li>
</ul>
<p>分页类, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span>  rest_framework.pagination <span class="keyword">import</span> PageNumberPagination,LimitOffsetPagination</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StudentLimitOffsetPagination</span>(<span class="title class_ inherited__">LimitOffsetPagination</span>):</span><br><span class="line">    limit_query_param = <span class="string">&quot;limit&quot;</span> <span class="comment"># 查询字符串中代表每一页数据的变量名</span></span><br><span class="line">    offset_query_param = <span class="string">&quot;offset&quot;</span> <span class="comment"># 查询字符串中代表页码的变量名</span></span><br><span class="line">    default_limit = <span class="number">2</span> <span class="comment"># 每一页的数据量</span></span><br><span class="line">    max_limit = <span class="number">4</span> <span class="comment"># 允许客户端通过查询字符串调整的最大单页数据量</span></span><br></pre></td></tr></table></figure>

<p>视图, <code>views</code> , 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .paginations <span class="keyword">import</span> StudentPageNumberPagination,StudentLimitOffsetPagination</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student3ModelViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Student.objects.<span class="built_in">all</span>()</span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line">    pagination_class = StudentLimitOffsetPagination</span><br></pre></td></tr></table></figure>

<h2 id="11-7-异常处理-Exceptions"><a href="#11-7-异常处理-Exceptions" class="headerlink" title="11.7. 异常处理 Exceptions"></a>11.7. 异常处理 Exceptions</h2><p>REST framework提供了异常处理, 我们可以自定义异常处理函数. 例如我们想在要创建一个自定义异常函数, </p>
<p>这个函数, 我们保存到当前子应用opt中[注意, 开发时, 我们会找个独立的公共目录来保存这种公共的函数&#x2F;工具&#x2F;类库].</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_exception_handler</span>(<span class="params">exc, context</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 先调用REST framework默认的异常处理方法获得标准错误响应对象&quot;&quot;&quot;</span></span><br><span class="line">    response = exception_handler(exc, context)</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 在此处补充自定义的异常处理&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        response.data[<span class="string">&#x27;status_code&#x27;</span>] = response.status_code</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>在配置文件中声明自定义的异常处理, <code>settings</code> , 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;EXCEPTION_HANDLER&#x27;</span>: <span class="string">&#x27;drfdemo.exceptions.custom_excetion_handle&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果未声明, 会采用默认的方式, 如下</p>
<p>rest_frame&#x2F;settings.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;EXCEPTION_HANDLER&#x27;</span>: <span class="string">&#x27;rest_framework.views.exception_handler&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如:</p>
<p>补充上处理关于数据库的异常, 这里使用其他异常来举例:</p>
<p><code>主应用.exceptions</code> , 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;# 自定义异常函数: 在drf本身提供的异常函数基础上，我们增加更多的异常处理就可以了。&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> exception_handler</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> DatabaseError</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> status</span><br><span class="line"><span class="keyword">from</span> rest_framework.response <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_excetion_handle</span>(<span class="params">exc, context</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    自定义异常函数，必须要在配置文件中注册才能被drf使用</span></span><br><span class="line"><span class="string">    exc: 异常对象，本次发生的异常对象</span></span><br><span class="line"><span class="string">    context: 字典，本次发生异常时，python解析器提供的执行上下文</span></span><br><span class="line"><span class="string">    所谓的执行上下文[context]，就是程序执行到当前一行代码时，能提供给开发者调用的环境信息异常发生时，代码所在的路径，时间，视图，客户端http请求等等...]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 先让drf处理它能识别的异常&quot;&quot;&quot;</span></span><br><span class="line">    response = exception_handler(exc, context)</span><br><span class="line">    <span class="string">&quot;&quot;&quot;# 在经过了drf的异常处理以后，还是返回None则表示有2种情况:&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> response <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;# 异常发生时的视图对象&quot;&quot;&quot;</span></span><br><span class="line">        view = context[<span class="string">&#x27;view&#x27;</span>]</span><br><span class="line">        <span class="string">&quot;&quot;&quot;# 异常发生时的http请求&quot;&quot;&quot;</span></span><br><span class="line">        request = context[<span class="string">&quot;request&quot;</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(exc, DatabaseError):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[%s]: %s&#x27;</span> % (view, exc))</span><br><span class="line">            response = Response(&#123;<span class="string">&#x27;detail&#x27;</span>: <span class="string">&#x27;服务器内部错误&#x27;</span>&#125;, status=status.HTTP_507_INSUFFICIENT_STORAGE)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(exc, TypeError):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;0不能作为除数~&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(request)</span><br><span class="line">            response = Response(&#123;<span class="string">&#x27;detail&#x27;</span>: <span class="string">&#x27;0不能作为除数&#x27;</span>&#125;, status=status.HTTP_500_INTERNAL_SERVER_ERROR)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<p>视图中, 故意报错:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .paginations <span class="keyword">import</span> StudentPageNumberPagination,StudentLimitOffsetPagination</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student3ModelViewSet</span>(<span class="title class_ inherited__">ModelViewSet</span>):</span><br><span class="line">    queryset = Student.objects  <span class="comment"># 去掉 .all()，就会报错。</span></span><br><span class="line">    serializer_class = StudentModelSerializer</span><br><span class="line">    pagination_class = StudentPageNumberPagination</span><br></pre></td></tr></table></figure>

<h3 id="REST-framework定义的异常"><a href="#REST-framework定义的异常" class="headerlink" title="REST framework定义的异常"></a>REST framework定义的异常</h3><ul>
<li>APIException 所有异常的父类</li>
<li>ParseError 解析错误</li>
<li>AuthenticationFailed 认证失败</li>
<li>NotAuthenticated 尚未认证</li>
<li>PermissionDenied 权限决绝</li>
<li>NotFound 未找到</li>
<li>MethodNotAllowed 请求方式不支持</li>
<li>NotAcceptable 要获取的数据格式不支持</li>
<li>Throttled 超过限流次数</li>
<li>ValidationError 校验失败</li>
</ul>
<p>也就是说, 很多的没有在上面列出来的异常, 就需要我们在自定义异常中自己处理了.</p>
<h2 id="11-8-自动生成接口文档"><a href="#11-8-自动生成接口文档" class="headerlink" title="11.8. 自动生成接口文档"></a>11.8. 自动生成接口文档</h2><p>REST framework可以自动帮助我们生成接口文档.</p>
<p>接口文档以网页的方式呈现.</p>
<p>自动接口文档能生成的是继承自 <code>APIView</code> 及其子类的视图.</p>
<h3 id="11-8-1-安装依赖"><a href="#11-8-1-安装依赖" class="headerlink" title="11.8.1. 安装依赖"></a>11.8.1. 安装依赖</h3><p>REST framewrok生成接口文档需要 <code>coreapi</code> 库的支持.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install coreapi</span><br></pre></td></tr></table></figure>

<h3 id="11-8-2-设置接口文档访问路径"><a href="#11-8-2-设置接口文档访问路径" class="headerlink" title="11.8.2. 设置接口文档访问路径"></a>11.8.2. 设置接口文档访问路径</h3><p>在总路由中添加接口文档路径.</p>
<p>文档路由对应的视图配置为 <code>rest_framework.documentation.include_docs_urls</code> , </p>
<p>参数 <code>title</code> 为接口文档网站的标题. 总路由, 代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.documentation <span class="keyword">import</span> include_docs_urls</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    path(<span class="string">&#x27;docs/&#x27;</span>, include_docs_urls(title=<span class="string">&#x27;站点页面标题&#x27;</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>在settings.py中配置接口文档.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    <span class="string">&#x27;DEFAULT_SCHEMA_CLASS&#x27;</span>: <span class="string">&#x27;rest_framework.schemas.AutoSchema&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-8-3-文档描述说明的定义位置"><a href="#11-8-3-文档描述说明的定义位置" class="headerlink" title="11.8.3. 文档描述说明的定义位置"></a>11.8.3. 文档描述说明的定义位置</h3><ol>
<li>单一方法的视图, 可直接使用类视图的文档字符串, 如</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookListView</span>(generics.ListAPIView):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    返回所有图书信息.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>2)包含多个方法的视图, 在类视图的文档字符串中, 分开方法定义, 如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookListCreateView</span>(generics.ListCreateAPIView):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    get:</span></span><br><span class="line"><span class="string">    返回所有图书信息.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    post:</span></span><br><span class="line"><span class="string">    新建图书.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>3)对于视图集ViewSet, 仍在类视图的文档字符串中封开定义, 但是应使用action名称区分, 如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BookInfoViewSet</span>(mixins.ListModelMixin, mixins.RetrieveModelMixin, GenericViewSet):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    list:</span></span><br><span class="line"><span class="string">    返回图书列表数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    retrieve:</span></span><br><span class="line"><span class="string">    返回图书详情数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    latest:</span></span><br><span class="line"><span class="string">    返回最新的图书数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    read:</span></span><br><span class="line"><span class="string">    修改图书的阅读量</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="11-8-4-访问接口文档网页"><a href="#11-8-4-访问接口文档网页" class="headerlink" title="11.8.4. 访问接口文档网页"></a>11.8.4. 访问接口文档网页</h3><p>浏览器访问 127.0.0.1:8000&#x2F;docs&#x2F;, 即可看到自动生成的接口文档.</p>
<p><img src="/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E9%A1%B5%E9%9D%A2.png" alt="æ¥å£ææ¡£ç½é¡µ"></p>
<p>两点说明:</p>
<ol>
<li>视图集ViewSet中的retrieve名称, 在接口文档网站中叫做read</li>
</ol>
<p>2)参数的Description需要在模型类或序列化器类的字段中以help_text选项定义, 如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>, verbose_name=<span class="string">&#x27;年龄&#x27;</span>, help_text=<span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StudentSerializer</span>(serializers.ModelSerializer):</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = Student</span><br><span class="line">        fields = <span class="string">&quot;__all__&quot;</span></span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            <span class="string">&#x27;age&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;required&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&#x27;help_text&#x27;</span>: <span class="string">&#x27;年龄&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="https://champion-yang.github.io/2024/07/01/DRF%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="DRF源码解析" target="_blank" rel="external">https://champion-yang.github.io/2024/07/01/DRF源码解析/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/champion-yang" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/champion-yang" target="_blank"><span class="text-dark">柯北</span><small class="ml-1x">研发工程师&amp;系统架构师&amp;项目管理</small></a></h3>
        <div>一个精通项目管理和系统架构的工程师</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2024/07/01/redis%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7/" title="redis缓存一致性"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2024/06/28/hexo%E5%BB%BA%E7%AB%99/" title="hexo建站"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn " data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="文章目录" role="button">    <span>[&nbsp;</span><span>文章目录</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/champion-yang" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="https://weibo.com/u/5730240952?tabtype=home" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2024 Sanil
        
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: true,
    notify: true,
    appId: '4ll1uZVubwWePbsBRZrDbx5O-gzGzoHsz',
    appKey: 'vqBEKFZgYPiJ5DGWNxCt8MtR',
    placeholder: 'Please leave me a message',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







  <!-- 自定义功能，复制代码插件 -->
  <!-- 参考：https://kangaroohy.com/tools/hexo-theme-pure-optimize.html -->
  
    <style>
      .copy-btn {
        display: inline-block;
        padding: 6px 12px;
        font-size: 13px;
        font-weight: 700;
        line-height: 20px;
        color: #333;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        background-color: #eee;
        background-image: linear-gradient(#fcfcfc, #eee);
        border: 1px solid #d5d5d5;
        border-radius: 3px;
        user-select: none;
        outline: 0;
      }
  
      .highlight-wrap .copy-btn {
        transition: opacity .3s ease-in-out;
        opacity: 0;
        padding: 2px 6px;
        position: absolute;
        right: 4px;
        top: 8px;
        z-index: 2;
      }
  
      .highlight-wrap:hover .copy-btn,
          .highlight-wrap .copy-btn:focus {
        opacity: 1
      }
  
      .highlight-wrap {
        position: relative;
      }
    </style>
    
    <script>
      addLoadEvent(()=>{
        $('.highlight').each(function (i, e) {
          var $wrap = $('<div>').addClass('highlight-wrap')
          $(e).after($wrap)
          $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
            var code = $(this).parent().find(".code")[0].innerText
            
                code += "\n/**\n* 感谢您复制代码，使用代码请注明引用出处\n* \n*/"
            
            var ta = document.createElement('textarea')
            document.body.appendChild(ta)
            ta.style.position = 'absolute'
            ta.style.top = '0px'
            ta.style.left = '0px'
            ta.value = code
            ta.select()
            ta.focus()
            var result = document.execCommand('copy')
            document.body.removeChild(ta)
            
              if(result)$(this).text('复制成功')
              else $(this).text('复制失败')
            
            $(this).blur()
          })).on('mouseleave', function (e) {
            var $b = $(this).find('.copy-btn')
            setTimeout(function () {
              $b.text('复制')
            }, 300)
          }).append(e)
        })
      })
    </script>
  
  
</body>
</html>