---
title: 研发工程视角下的数据分析(数据处理)
date: 2024-07-04 14:06:55
tags: Pandas
toc: true
categories: [数据科学, 数据处理]
---

# 背景

在大数据时代的背景下, 数据已经成为企业中最重要的资产和生产要素. 如何从数据中发现并挖掘有价值的信息则显得尤为重要. 在项目交付过程中, 数据是平台/xx系统的基础, 而作为研发人员经常会面对客户的提数需求, 这部分需求经常具备个性化、临时性、一次性等特点. 如下作为示例:
* 产品需求: 系统上线后数据异常原因排查; 新老版本数据融合需求; 数据报表需求等
* 运营需求: 某次任务关联的报告数据; 通过系统数据做趋势预测; 数据变动的原因分析等
* 客户需求: 提取某次数据上报过程中某省单位的上报详情并出具分析报告; 查一下某个时间点下系统数据的合规率等
本系列的文章介绍的数据分析区别于BI工程师【数据分析师】的数据分析, 现实情况中BI们往往在做业务方最关心的数据、最关心的问题等方向的分析, 对于日常过程中的个性化、临时性的数分需求, 一般都是通过研发工程师进行实现. 本系列文章的重点将会以研发工程师【非BI】的视角出发, 介绍如何通过 Python 快速进行数据分析.

# 数据分析的流程

知其然, 需知其所以然. 数据科学是一门复杂的学科, 包括了统计学、数据分析、机器学习在内的多种学科方法, 而数据分析则关注在现有的数据集中, 执行和处理统计分析. 体系化的了解数据分析的流程, 是做数据分析的前置条件.
常规的数据分析流程如下:

![img](../../images/pandas/01.png )

* 明确分析思路和目的: 我们接到一个分析任务, 首先要弄清楚我们分析的对象是什么, 要达成怎样的目的, 不能陷于为了分析而分析. 然后, 要熟悉行业和业务, 透彻的理解分析的目的, 构建起分析的角度和体系.
* 数据收集: 按照确定的数据分析的思路和框架, 进行数据收集和整合.
* 数据处理: 对收集到的数据进行清洗、加工、整理等
* 数据分析: 通过分析手段、方法和技巧等对准备好的数据进行探索分析, 从中发现数据的规律.
* 数据展现: 通过图表或者报告的形式进行数据到的展现.
# 从研发视角看数据分析【数据处理篇】

作为研发工程师, 在常规的项目中, 假定我们现在接收到的临时性的提数需求已经和产品经理/项目经理就数分的思路和目的达成了一致, 并且系统中的数据已经通过南向接口或其他方式进行了收集, 下一步要展开数据处理过程.
数据清洗是数据预处理的第一步, 主要是为了解决数据中的缺失值、异常值、重复值等问题. Python提供了pandas库可以帮助我们方便地处理源数据中的缺失值、重复值和异常值, 数据处理可以极大的提升数据的质量, 只有经过处理的数据才可以作为下一步数据分析模型的输入.
pandas常用的基本功能如下:
* 从Excel、CSV、网页、SQL、剪贴板等文件或工具中读取数据; 
* 合并多个文件或者电子表格中的数据, 将数据拆分为独立文件; 
* 数据清洗, 如去重、处理缺失值、填充默认值、补全格式、处理极端值等; 
* 建立高效的索引; 
* 支持大体量数据; 
* 按一定业务逻辑插入计算后的列、删除列; 
* 灵活方便的数据查询、筛选; 
* 分组聚合数据, 可独立指定分组后的各字段计算方式; 
* 数据的转置, 如行转列、列转行变更处理; 
* 连接数据库, 直接用SQL查询数据并进行处理; 
* 对时序数据进行分组采样, 如按季、按月、按工作小时, 也可以自定义周期, 如工作日; 
* 窗口计算, 移动窗口统计、日期移动等; 
* 灵活的可视化图表输出, 支持所有的统计图形; 
* 为数据表格增加展示样式, 提高数据识别效率.
# 实践应用

## 准备工作

### 环境准备

```shell
pip install pandas
```

### 数据集分析

在准备员工一到四月的考核结果表, 各列说明如下:
* name: 员工的姓名, 这列没有重复值, 一个员工一行
* team: 所在的团队, 这个数据会重复
* 一月～四月: 各个月份的考核结果, 可能会有重复值, 缺失值, 异常值

<img src="/images/pandas/02.png"   style="zoom:20%; " />

## 使用示例

### 缺失值处理

#### 检查是否有缺失值

关键技术: isnull()方法返回值为布尔值, 如果数据存在缺失值, 返回True; 否则, 返回False.

<img src=/images/pandas/03.png   style="zoom:20%; " />

经查, 原始数据中具备缺失值.

#### 需求案例A: 如果该行具有缺失值, 则这一行数据被丢弃

关键技术: dropna()用于删除含有缺失值的行.

<img src=/images/pandas/04.png   style="zoom:20%; " />

#### 需求案例B: 如果该行具有缺失值, 则缺失的值使用平均值进行填充

关键技术: fillna()方法用于填充含有缺失值的行.mean()方法用于求改行的平均值.

<img src=/images/pandas/05.png   style="zoom:20%; " />

### 重复值处理

#### 检查是否有重复值

关键技术: duplicated()方法检测冗余的行或列, 默认是判断全部列中的值是否全部重复, 并返回布尔类型的结果. 对于完全没有重复的行, 返回值为False. 对于有重复值的行, 第一次出现重复的那一行返回False, 其余的返回True.

<img src=/images/pandas/06.png   style="zoom:20%; " />

#### 需求案例C: 如果该行有重复值则丢弃该行数据

关键技术: drop_duplicates()删除重复的行.

<img src=/images/pandas/07.png   style="zoom:20%; " />

### 异常值检测和处理

#### 检查是否有异常值

关键技术:query()方法查询数据中是否有异常值, 用于在 DataFrame 中执行类似于 SQL 的查询的工具, 支持简单查询, 逻辑运算查询, 字符串查询等.

<img src=/images/pandas/08.png   style="zoom:20%; " />

### 输出新的文件

#### 需求案例D: 根据描述输出报告

需求描述: 将原始数据根据姓名进行分组, 缺失值和异常值默认按照0进行统计, 计算每个人的平均分并从大到小进行排序, 输出内容到 excel.
代码:

```python
# 引入Pandas库

import pandas as pd

# 读取excel内容

df = pd.read_excel("./数据集/team.xlsx", )

# 用 0 填充缺失值

df = df.fillna(0)

# 删除重复的行

df = df.drop_duplicates().copy()

# 缺失值和异常值默认按照0进行填充

df[["一月", "二月", "三月", "四月"]] = df[["一月", "二月", "三月", "四月"]].applymap(lambda x: 0 if x > 100 or x < 0 else x)

# 增加一列, 平均值

df['平均值'] = df[["一月", "二月", "三月", "四月"]].mean(axis=1).round(1)

# 按照平均值排序

df = df.sort_values(['平均值'], ascending=False)

# 将数据输出到Excel文件中

df.to_excel('./output.xlsx', index=False)
```

输出的excel结果如下:

<img src=/images/pandas/09.png   style="zoom:20%; " />

# 总结

本文简单介绍了数据分析的流程以及如何做数据的预处理. 利用几个示例对工作中常见的操作进行了说明, 从代码的层面可以看出, 利用 Python 进行数据分析的操作会更加的灵活快捷方便, 尤其是在临时性的需求面前, 会大大节约我们的时间和资源成本.
